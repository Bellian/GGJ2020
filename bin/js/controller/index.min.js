!function i(o,s,c){function l(t,e){if(!s[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var n=s[t]={exports:{}};o[t][0].call(n.exports,function(e){return l(o[t][1][e]||e)},n,n.exports,i,o,s,c)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=e("./index"),n=(i.prototype.onUpdateServerData=function(e){this.updateServerCallbacks.add(e)},i.prototype.updateServerData=function(){var t=this;this.updateServerCallbacks.forEach(function(e){return e(t.serverData)})},i.prototype.currentPlayerData=function(){var t=this;return this.playerData.filter(function(e){return e.id===t.id})[0]},i.prototype.sendControllerData=function(e){e.id=this.id,this.notifyServer(e)},i.prototype.subscribeToAirConsole=function(){var r=this;this.airconsole.onMessage=function(e,t){switch(t.transactionType){case a.TransactionType.PlayerData:r.playerData=t.playerData;break;case a.TransactionType.ObjectData:r.objectData=t.objectData;break;case a.TransactionType.ServerData:r.serverData=t.serverData,r.updateServerData();break;default:console.error("not implemented",t)}}},i.prototype.toggleAngryDad=function(){var e=this.currentPlayerData();return void 0===e.isAngryDad?e.isAngryDad=!1:e.isAngryDad=!e.isAngryDad,this.notifyServer(e),e.isAngryDad},i.prototype.changeAppearance=function(e){var t=this.currentPlayerData();return t.characterAppearanceType=e,this.notifyServer(t),t.characterAppearanceType},i.prototype.notifyServer=function(e){this.airconsole.message(AirConsole.SCREEN,JSON.stringify(e))},i.prototype.getTime=function(){return this.serverData.timerValueInSeconds},i);function i(){this.id=0,this.playerData=[],this.objectData=[],this.serverData=new a.ServerData,this.updateServerCallbacks=new Set,this.airconsole=new AirConsole,this.id||(this.id=this.airconsole.getDeviceId()),this.subscribeToAirConsole()}r.Client=n},{"./index":2}],2:[function(e,t,r){"use strict";function a(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0}),a(e("./client")),a(e("./server"));function n(e,t,r){this.x=e,this.y=t,this.transactionType=i.PlayerData,this.playerState=d.idle,this.characterAppearanceType=h.wichtel1,this.isAngryDad=void 0,this.id=0,this.id=r}var i,o,s,c;r.PlayerData=n,(o=i=r.TransactionType||(r.TransactionType={}))[o.ServerData=0]="ServerData",o[o.PlayerData=1]="PlayerData",o[o.ControllerData=2]="ControllerData",o[o.ObjectData=3]="ObjectData",(c=s=r.ServerState||(r.ServerState={}))[c.initial=0]="initial",c[c.lobby=1]="lobby",c[c.characterSelection=2]="characterSelection",c[c.running=3]="running",c[c.final=4]="final";function l(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t,this.transactionType=i.ControllerData,this.id=0}r.ControllerData=l;function u(e,t){void 0===e&&(e=30),void 0===t&&(t=s.initial),this.timerValueInSeconds=e,this.serverState=t}var d,p,h,y;r.ServerData=u,(p=d=r.PlayerState||(r.PlayerState={}))[p.idle=0]="idle",p[p.dead=1]="dead",p[p.running=2]="running",p[p.interacting=3]="interacting",(y=h=r.CharacterAppearanceType||(r.CharacterAppearanceType={}))[y.wichtel1=0]="wichtel1",y[y.wichtel2=1]="wichtel2",y[y.wichtel3=2]="wichtel3",y[y.wichtel4=3]="wichtel4";function v(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t,this.id=r}r.ObjectData=v},{"./client":1,"./server":3}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=e("./index"),n=(i.prototype.createAndUpdatePlayer=function(t){var e=this.playerData.find(function(e){return e.id===t.id});e||(e=new a.PlayerData(0,0,t.id),this.playerData.push(e),this.startAfterFirstPlayerJoined()),this.updatePlayer(t)},i.prototype.startAfterFirstPlayerJoined=function(){var e=this;1==this.playerData.length&&(this.serverData.serverState=a.ServerState.lobby,this.updateServerState(),this.serverStateUpdate(30,a.ServerState.characterSelection,function(){e.serverStateUpdate(15,a.ServerState.running,function(){e.serverStateUpdate(300,a.ServerState.final,function(){})})}))},i.prototype.serverStateUpdate=function(e,t,r){var a=this,n=this.setAndStartTimer(e);setTimeout(function(){a.serverData.serverState=t,a.updateServerState(),r(),clearInterval(n)},e)},i.prototype.setAndStartTimer=function(e){var t=this;return this.serverData.timerValueInSeconds=e,setInterval(function(){t.serverData.timerValueInSeconds&&t.serverData.timerValueInSeconds--,t.sendServerData()},1e3)},i.prototype.updatePlayer=function(t){this.playerData.filter(function(e){return e.id===t.id})[0],this.sendPlayerData()},i.prototype.sendAllClients=function(e){this.airConsole.broadcast(e)},i.prototype.onMessage=function(){var r=this;this.airConsole.onMessage=function(e,t){switch(t.transactionType){case a.TransactionType.PlayerData:r.createAndUpdatePlayer(t);break;case a.TransactionType.ControllerData:r.updateControllerData(t);break;default:console.error("not implemented",t)}r.sendPlayerData()}},i.prototype.subscribeToAirConsole=function(){var t=this;this.airConsole.onConnect=function(e){t.createAndUpdatePlayer({id:e}),t.sendObjectData(),t.sendServerData()}},i.prototype.sendPlayerData=function(){this.sendAllClients({transactionType:a.TransactionType.PlayerData,playerData:this.playerData})},i.prototype.sendObjectData=function(){this.sendAllClients({transactionType:a.TransactionType.ObjectData,objectData:this.objectData})},i.prototype.sendServerData=function(){this.sendAllClients({transactionType:a.TransactionType.ServerData,serverData:this.serverData})},i);function i(){var t=this;this.playerData=[],this.objectData=[],this.updateServerState=function(){return function(e){e(t.serverData.serverState)}},this.updateControllerData=function(t){return function(e){e(t)}},this.airConsole=new AirConsole,this.serverData=new a.ServerData,this.subscribeToAirConsole()}r.Server=n},{"./index":2}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a,n,i=e("../common/index");function o(e){var t=this;this.client=e,this.startPos=void 0,document.addEventListener("DOMContentLoaded",function(){t.virtualController(),t.client.onUpdateServerData(t.updateView.bind(t))})}(n=a=a||{})[n.splashscreen=0]="splashscreen",n[n.characterselection=1]="characterselection",n[n.playscreen=2]="playscreen",n[n.endscreen=3]="endscreen",new(o.prototype.showView=function(e){document.querySelectorAll(a[e])[0].classList.add("visible")},o.prototype.hideView=function(e){document.querySelectorAll(a[e])[0].classList.remove("visible")},o.prototype.updateView=function(e){switch(e.serverState){case i.ServerState.lobby:this.showView(a.splashscreen);break;case i.ServerState.characterSelection:this.showView(a.characterselection);break;case i.ServerState.running:this.showView(a.playscreen);break;case i.ServerState.final:this.showView(a.endscreen);break;default:console.error("not implemented",e)}},o.prototype.virtualController=function(){var t=this;document.querySelectorAll("controller")[0].addEventListener("touchstart",function(e){console.log("touchstart"),t.startPos=[e.targetTouches[0].clientX,e.targetTouches[0].clientY]}),document.querySelectorAll("controller")[0].addEventListener("touchmove",function(e){void 0!==t.startPos&&t.client.sendControllerData(new i.ControllerData(e.targetTouches[0].clientX-t.startPos[0],e.targetTouches[0].clientY-t.startPos[1]))}),document.querySelectorAll("controller")[0].addEventListener("touchend",function(e){t.startPos=void 0})},o.prototype.splashscreen=function(){var a=this;document.querySelectorAll("splashscreen > button").forEach(function(e){var t=document.querySelectorAll("splashscreen > character")[0],r=a.client.toggleAngryDad();t.innerHTML=r?"You would like to be angry dad!":"You would like to be a wichtel!"});var t=setInterval(function(){var e=a.client.getTime();document.querySelectorAll("splashscreen > time")[0].innerHTML=e.toString(),0===e&&clearInterval(t)},1e3)},o)(new i.Client)},{"../common/index":2}]},{},[4]);
//# sourceMappingURL=index.min.js.map
