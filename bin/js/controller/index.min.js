!function o(i,s,c){function l(t,e){if(!s[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var n=s[t]={exports:{}};i[t][0].call(n.exports,function(e){return l(i[t][1][e]||e)},n,n.exports,o,i,s,c)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./index"),r=(o.prototype.onUpdateServerData=function(e){this.updateServerCallbacks.add(e)},o.prototype.updateServerData=function(){var t=this;this.updateServerCallbacks.forEach(function(e){return e(t.serverData)})},o.prototype.currentPlayerData=function(){var t=this;return console.table("currentPlayerData playerData",this.playerData),console.table("currentPlayerData id",this.id),this.playerData.filter(function(e){return e.id===t.id})[0]},o.prototype.sendControllerData=function(e){e.id=this.id,this.notifyServer(e)},o.prototype.subscribeToAirConsole=function(){var r=this;this.airConsole.onMessage=function(e,t){if(t){var a=JSON.parse(t);switch(a.transactionType){case n.TransactionType.PlayerData:console.log("received player data",a),r.playerData=a.playerData;break;case n.TransactionType.ObjectData:console.log("received object data",a),r.objectData=a.objectData;break;case n.TransactionType.ServerData:console.log("received server data",a),r.serverData=a.serverData,r.updateServerData();break;default:console.error("client onMessage switch",t)}}else console.error("client onMessage",t)}},o.prototype.toggleAngryDad=function(){console.table("toggleAngryDad playerData",this.playerData),console.table("toggleAngryDad id",this.id);var e=this.currentPlayerData();return void 0===e.isAngryDad?e.isAngryDad=!1:e.isAngryDad=!e.isAngryDad,this.notifyServer(e),e.isAngryDad},o.prototype.changeAppearance=function(e){var t=this.currentPlayerData();return t.characterAppearanceType=e,this.notifyServer(t),t.characterAppearanceType},o.prototype.interacting=function(e){var t=this.currentPlayerData();return t.playerState=e,this.notifyServer(t),t.playerState},o.prototype.notifyServer=function(e){this.airConsole.message(AirConsole.SCREEN,JSON.stringify(e))},o.prototype.getTime=function(){return this.serverData.timerValueInSeconds},o);function o(){var t=this;this.id=0,this.playerData=[],this.objectData=[],this.updateServerCallbacks=new Set,this.serverData=new n.ServerData(30,n.ServerState.initial),this.airConsole=new AirConsole,this.airConsole.onDeviceStateChange=function(e){t.id=e,t.subscribeToAirConsole()}}a.Client=r},{"./index":2}],2:[function(e,t,a){"use strict";function r(e){for(var t in e)a.hasOwnProperty(t)||(a[t]=e[t])}Object.defineProperty(a,"__esModule",{value:!0}),r(e("./client")),r(e("./server"));function n(e,t,a){this.x=e,this.y=t,this.id=a,this.transactionType=o.PlayerData,this.playerState=u.idle,this.isAngryDad=!1,this.characterAppearanceType=p.wichtel1}var o,i,s;a.PlayerData=n,(i=o=a.TransactionType||(a.TransactionType={}))[i.ServerData=0]="ServerData",i[i.PlayerData=1]="PlayerData",i[i.ControllerData=2]="ControllerData",i[i.ObjectData=3]="ObjectData",(s=a.ServerState||(a.ServerState={}))[s.initial=0]="initial",s[s.lobby=1]="lobby",s[s.characterSelection=2]="characterSelection",s[s.running=3]="running",s[s.final=4]="final";function c(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t,this.id=0,this.transactionType=o.ControllerData}a.ControllerData=c;function l(e,t){void 0===e&&(e=30),this.timerValueInSeconds=e,this.serverState=t}var u,d,p,y;a.ServerData=l,(d=u=a.PlayerState||(a.PlayerState={}))[d.idle=0]="idle",d[d.dead=1]="dead",d[d.running=2]="running",d[d.interacting=3]="interacting",(y=p=a.CharacterAppearanceType||(a.CharacterAppearanceType={}))[y.wichtel1=0]="wichtel1",y[y.wichtel2=1]="wichtel2",y[y.wichtel3=2]="wichtel3",y[y.wichtel4=3]="wichtel4";function h(e,t,a,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===a&&(a=0),this.x=e,this.y=t,this.damage=a,this.objectId=r}a.ObjectData=h},{"./client":1,"./server":3}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./index");n.OBJECTDATAMAXHEALTH=10;var a=(r.prototype.onUpdateServerState=function(e){this.updateControllerCallbacks.add(e)},r.prototype.updateServerState=function(){var t=this;this.updateServerCallbacks.forEach(function(e){return e(t.serverData.serverState)})},r.prototype.onUpdateControllerData=function(e){this.updateControllerCallbacks.add(e)},r.prototype.updateControllerData=function(t){this.updateControllerCallbacks.forEach(function(e){return e(t)})},r.prototype.createAndUpdatePlayer=function(t){var e=this.playerData.find(function(e){return e.id===t.id});e?this.updatePlayer(t):(e=new o.PlayerData(0,0,t.id),this.playerData.push(e),this.startAfterFirstPlayerJoined())},r.prototype.startAfterFirstPlayerJoined=function(){var e=this;1==this.playerData.length&&(this.serverData.serverState=o.ServerState.lobby,this.updateServerState(),this.serverStateUpdate(30,o.ServerState.characterSelection,function(){console.log("changed server state to character selection"),e.serverStateUpdate(15,o.ServerState.running,function(){e.serverStateUpdate(300,o.ServerState.final,function(){})})}))},r.prototype.serverStateUpdate=function(e,t,a){var r=this,n=this.setAndStartTimer(e);setTimeout(function(){clearInterval(n),r.serverData.serverState=t,r.updateServerState(),r.serverData.serverState===o.ServerState.running&&r.setAngryDad(),a()},1e3*e)},r.prototype.setAngryDad=function(){var e=this.playerData.filter(function(e){e.isAngryDad}),t=e.length;if(console.log("wantAngryDads",e),console.log("countAngryDads",t),console.table("playerData",this.playerData),0===t){var a=Math.floor(Math.random()*this.playerData.length);this.playerData.map(function(e){return e.isAngryDad=!1}),this.playerData[a].isAngryDad=!0}if(1<t){var r=e[Math.floor(Math.random()*t)].id;this.playerData.map(function(e){return e.isAngryDad=!1}),this.playerData.filter(function(e){return e.id===r})[0].isAngryDad=!0}},r.prototype.setAndStartTimer=function(e){var t=this;return this.serverData.timerValueInSeconds=e,setInterval(function(){t.serverData.timerValueInSeconds&&t.serverData.timerValueInSeconds--},1e3)},r.prototype.updatePlayer=function(t){var e=this.playerData.find(function(e){return e.id===t.id});if(e){var a=this.playerData.indexOf(e);if((this.playerData[a]=t).playerState===o.PlayerState.interacting){var r={damage:0,x:0,y:0,objectId:0};r&&(r.damage+=t.isAngryDad?-1:1,r.damage>n.OBJECTDATAMAXHEALTH&&(r.damage=n.OBJECTDATAMAXHEALTH),r.damage<0&&(r.damage=0)),t.isAngryDad}}},r.prototype.sendAllClients=function(e){this.airConsole.broadcast(JSON.stringify(e))},r.prototype.onMessage=function(){var r=this;this.airConsole.onMessage=function(e,t){if(t){var a=JSON.parse(t);switch(a.transactionType){case o.TransactionType.PlayerData:r.createAndUpdatePlayer(a);break;case o.TransactionType.ControllerData:r.updateControllerData(a);break;default:console.error("server onMessage",t)}}}},r.prototype.subscribeToAirConsole=function(){var a=this;this.onMessage(),this.airConsole.onConnect=function(e){a.createAndUpdatePlayer({id:e}),a.sendPlayerToClient||(a.sendPlayerToClient=setInterval(function(){a.sendPlayerData(),a.sendServerData(),a.sendObjectData()},500))},this.airConsole.onDisconnect=function(t){a.playerData.splice(a.playerData.indexOf(a.playerData.filter(function(e){return e.id===t})[0]),1)}},r.prototype.sendPlayerData=function(){this.sendAllClients({transactionType:o.TransactionType.PlayerData,playerData:this.playerData})},r.prototype.sendObjectData=function(){this.sendAllClients({transactionType:o.TransactionType.ObjectData,objectData:this.objectData})},r.prototype.sendServerData=function(){this.sendAllClients({transactionType:o.TransactionType.ServerData,serverData:this.serverData})},r);function r(){this.playerData=[],this.objectData=[],this.updateServerCallbacks=new Set,this.updateControllerCallbacks=new Set,this.airConsole=new AirConsole,this.serverData=new o.ServerData(30,o.ServerState.initial),this.subscribeToAirConsole()}n.Server=a},{"./index":2}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r,n,o=e("../common/index");(n=r=a.Views||(a.Views={}))[n.splashscreen=0]="splashscreen",n[n.characterselection=1]="characterselection",n[n.playscreen=2]="playscreen";var i=(s.prototype.onJoystickMove=function(e){this.joystickMoveCallbacks.add(e)},s.prototype.updateJoystickPosition=function(t){this.joystickMoveCallbacks.forEach(function(e){return e(t)})},s.prototype.showView=function(e){document.querySelectorAll(r[e])[0].classList.add("visible"),document.querySelectorAll(".view").forEach(function(e){return e.classList.remove("visible")})},s.prototype.updateView=function(e){switch(e){case"join":this.showView(r.splashscreen),this.lobby();break;case"choose":this.showView(r.characterselection),this.characterselection();break;case"game":this.showView(r.playscreen),this.virtualController();break;default:console.error("not implemented",e)}},s.prototype.virtualController=function(){var t=this;document.querySelectorAll("playscreen > controller")[0].addEventListener("touchstart",function(e){t.startPos=[e.targetTouches[0].clientX,e.targetTouches[0].clientY]}),document.querySelectorAll("playscreen > controller")[0].addEventListener("touchmove",function(e){void 0!==t.startPos&&t.updateJoystickPosition({x:e.targetTouches[0].clientX-t.startPos[0],y:-(e.targetTouches[0].clientY-t.startPos[1])})}),document.querySelectorAll("playscreen > controller")[0].addEventListener("touchend",function(e){t.startPos=void 0})},s.prototype.lobby=function(){this.setTime(r.splashscreen,30)},s.prototype.characterselection=function(){document.querySelectorAll("characterselection > characters > img").forEach(function(e){return e.addEventListener("click",function(){e.classList.contains("angry-dad")?(document.querySelectorAll("characterselection")[0].classList.add("isAngryDad"),console.log("You would like to be angry dad!")):(document.querySelectorAll("characterselection")[0].classList.remove("isAngryDad"),console.log("You would like to be a wichtel!"))})}),this.setTime(r.characterselection,15)},s.prototype.setTime=function(e,t){var a=setInterval(function(){document.querySelectorAll(r[e]+" time")[0].innerHTML=t.toString(),--t<=0&&clearInterval(a)},1e3)},s);function s(e){this.client=e,this.startPos=void 0,this.joystickMoveCallbacks=new Set,this.client.onUpdateServerData(this.updateView.bind(this))}document.addEventListener("DOMContentLoaded",function(){var e=new o.Client,t=new i(e);t.virtualController(),t.onJoystickMove(function(e){console.log(e)})})},{"../common/index":2}]},{},[4]);
//# sourceMappingURL=index.min.js.map
