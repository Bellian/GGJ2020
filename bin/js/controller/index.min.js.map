{"version":3,"sources":["index.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","index_1","Client","prototype","onUpdateServerData","cb","this","updateServerCallbacks","add","updateServerData","_this","forEach","serverData","currentPlayerData","playerData","filter","pD","id","sendControllerData","controllerData","notifyServer","subscribeToAirConsole","airConsole","onMessage","from","data","transactionType","TransactionType","PlayerData","ObjectData","objectData","ServerData","console","error","toggleAngryDad","currentPlayer","undefined","isAngryDad","changeAppearance","appearance","characterAppearanceType","interacting","playerState","message","AirConsole","SCREEN","JSON","stringify","getTime","timerValueInSeconds","Set","getDeviceId","./index","2","__export","m","hasOwnProperty","x","y","deviceId","PlayerState","idle","CharacterAppearanceType","wichtel1","ServerState","ControllerData","serverState","initial","damage","objectId","./client","./server","3","OBJECTDATAMAXHEALTH","Server","onUpdateServerState","updateControllerCallbacks","updateServerState","onUpdateControllerData","updateControllerData","createAndUpdatePlayer","playerFound","find","push","startAfterFirstPlayerJoined","updatePlayer","lobby","serverStateUpdate","characterSelection","running","final","timer","setAndStartTimer","setTimeout","clearInterval","setInterval","sendServerData","updateData","player","playerIndex","indexOf","itemFound","sendPlayerData","sendAllClients","broadcast","onConnect","sendObjectData","4","Views","Controller","showView","view","document","querySelectorAll","classList","hideView","remove","updateView","splashscreen","characterselection","playscreen","virtualController","endscreen","addEventListener","ev","startPos","targetTouches","clientX","clientY","client","setTime","btn","log","timeUntilInterval","timeUntil","innerHTML","toString","bind","controller","test","../common/index"],"mappings":"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","file":"index.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"./index\");\r\nvar Client = /** @class */ (function () {\r\n    function Client() {\r\n        this.id = 0;\r\n        this.playerData = [];\r\n        this.objectData = [];\r\n        this.updateServerCallbacks = new Set();\r\n        this.airConsole = new AirConsole();\r\n        this.serverData = new index_1.ServerData();\r\n        if (!this.id)\r\n            this.id = this.airConsole.getDeviceId();\r\n        this.subscribeToAirConsole();\r\n    }\r\n    Client.prototype.onUpdateServerData = function (cb) {\r\n        this.updateServerCallbacks.add(cb);\r\n    };\r\n    Client.prototype.updateServerData = function () {\r\n        var _this = this;\r\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData); });\r\n    };\r\n    Client.prototype.currentPlayerData = function () {\r\n        var _this = this;\r\n        return this.playerData.filter(function (pD) { return pD.id === _this.id; })[0];\r\n    };\r\n    Client.prototype.sendControllerData = function (controllerData) {\r\n        controllerData.id = this.id;\r\n        this.notifyServer(controllerData);\r\n    };\r\n    Client.prototype.subscribeToAirConsole = function () {\r\n        var _this = this;\r\n        this.airConsole.onMessage = function (from, data) {\r\n            switch (data.transactionType) {\r\n                case index_1.TransactionType.PlayerData:\r\n                    _this.playerData = data.playerData;\r\n                    break;\r\n                case index_1.TransactionType.ObjectData:\r\n                    _this.objectData = data.objectData;\r\n                    break;\r\n                case index_1.TransactionType.ServerData:\r\n                    _this.serverData = data.serverData;\r\n                    _this.updateServerData();\r\n                    break;\r\n                default:\r\n                    console.error(\"not implemented\", data);\r\n                    break;\r\n            }\r\n        };\r\n    };\r\n    Client.prototype.toggleAngryDad = function () {\r\n        var currentPlayer = this.currentPlayerData();\r\n        if (currentPlayer.isAngryDad === undefined) {\r\n            currentPlayer.isAngryDad = false;\r\n        }\r\n        else {\r\n            currentPlayer.isAngryDad = !currentPlayer.isAngryDad;\r\n        }\r\n        this.notifyServer(currentPlayer);\r\n        return currentPlayer.isAngryDad;\r\n    };\r\n    Client.prototype.changeAppearance = function (appearance) {\r\n        var currentPlayer = this.currentPlayerData();\r\n        currentPlayer.characterAppearanceType = appearance;\r\n        this.notifyServer(currentPlayer);\r\n        return currentPlayer.characterAppearanceType;\r\n    };\r\n    Client.prototype.interacting = function (playerState) {\r\n        var currentPlayer = this.currentPlayerData();\r\n        currentPlayer.playerState = playerState;\r\n        this.notifyServer(currentPlayer);\r\n        return currentPlayer.playerState;\r\n    };\r\n    Client.prototype.notifyServer = function (data) {\r\n        this.airConsole.message(AirConsole.SCREEN, JSON.stringify(data));\r\n    };\r\n    Client.prototype.getTime = function () {\r\n        return this.serverData.timerValueInSeconds;\r\n    };\r\n    return Client;\r\n}());\r\nexports.Client = Client;\r\n\r\n\r\n\r\n},{\"./index\":2}],2:[function(require,module,exports){\r\n\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./client\"));\r\n__export(require(\"./server\"));\r\nvar PlayerData = /** @class */ (function () {\r\n    function PlayerData(x, y, deviceId) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.transactionType = TransactionType.PlayerData;\r\n        this.playerState = PlayerState.idle;\r\n        this.characterAppearanceType = CharacterAppearanceType.wichtel1;\r\n        this.isAngryDad = undefined;\r\n        this.id = 0;\r\n        this.id = deviceId;\r\n    }\r\n    return PlayerData;\r\n}());\r\nexports.PlayerData = PlayerData;\r\nvar TransactionType;\r\n(function (TransactionType) {\r\n    TransactionType[TransactionType[\"ServerData\"] = 0] = \"ServerData\";\r\n    TransactionType[TransactionType[\"PlayerData\"] = 1] = \"PlayerData\";\r\n    TransactionType[TransactionType[\"ControllerData\"] = 2] = \"ControllerData\";\r\n    TransactionType[TransactionType[\"ObjectData\"] = 3] = \"ObjectData\";\r\n})(TransactionType = exports.TransactionType || (exports.TransactionType = {}));\r\nvar ServerState;\r\n(function (ServerState) {\r\n    ServerState[ServerState[\"initial\"] = 0] = \"initial\";\r\n    ServerState[ServerState[\"lobby\"] = 1] = \"lobby\";\r\n    ServerState[ServerState[\"characterSelection\"] = 2] = \"characterSelection\";\r\n    ServerState[ServerState[\"running\"] = 3] = \"running\";\r\n    ServerState[ServerState[\"final\"] = 4] = \"final\";\r\n})(ServerState = exports.ServerState || (exports.ServerState = {}));\r\nvar ControllerData = /** @class */ (function () {\r\n    function ControllerData(x, y) {\r\n        if (x === void 0) { x = 0; }\r\n        if (y === void 0) { y = 0; }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.transactionType = TransactionType.ControllerData;\r\n        this.id = 0;\r\n    }\r\n    return ControllerData;\r\n}());\r\nexports.ControllerData = ControllerData;\r\nvar ServerData = /** @class */ (function () {\r\n    function ServerData(timerValueInSeconds, serverState) {\r\n        if (timerValueInSeconds === void 0) { timerValueInSeconds = 30; }\r\n        if (serverState === void 0) { serverState = ServerState.initial; }\r\n        this.timerValueInSeconds = timerValueInSeconds;\r\n        this.serverState = serverState;\r\n    }\r\n    return ServerData;\r\n}());\r\nexports.ServerData = ServerData;\r\nvar PlayerState;\r\n(function (PlayerState) {\r\n    PlayerState[PlayerState[\"idle\"] = 0] = \"idle\";\r\n    PlayerState[PlayerState[\"dead\"] = 1] = \"dead\";\r\n    PlayerState[PlayerState[\"running\"] = 2] = \"running\";\r\n    PlayerState[PlayerState[\"interacting\"] = 3] = \"interacting\";\r\n})(PlayerState = exports.PlayerState || (exports.PlayerState = {}));\r\nvar CharacterAppearanceType;\r\n(function (CharacterAppearanceType) {\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel1\"] = 0] = \"wichtel1\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel2\"] = 1] = \"wichtel2\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel3\"] = 2] = \"wichtel3\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel4\"] = 3] = \"wichtel4\";\r\n})(CharacterAppearanceType = exports.CharacterAppearanceType || (exports.CharacterAppearanceType = {}));\r\nvar ObjectData = /** @class */ (function () {\r\n    function ObjectData(x, y, damage, objectId) {\r\n        if (x === void 0) { x = 0; }\r\n        if (y === void 0) { y = 0; }\r\n        if (damage === void 0) { damage = 0; }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.damage = damage;\r\n        this.objectId = objectId;\r\n    }\r\n    return ObjectData;\r\n}());\r\nexports.ObjectData = ObjectData;\r\n\r\n\r\n\r\n},{\"./client\":1,\"./server\":3}],3:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"./index\");\r\nexports.OBJECTDATAMAXHEALTH = 10;\r\nvar Server = /** @class */ (function () {\r\n    function Server() {\r\n        this.playerData = [];\r\n        this.objectData = [];\r\n        this.updateServerCallbacks = new Set();\r\n        this.updateControllerCallbacks = new Set();\r\n        this.airConsole = new AirConsole();\r\n        this.serverData = new index_1.ServerData();\r\n        this.subscribeToAirConsole();\r\n    }\r\n    Server.prototype.onUpdateServerState = function (cb) {\r\n        this.updateControllerCallbacks.add(cb);\r\n    };\r\n    Server.prototype.updateServerState = function () {\r\n        var _this = this;\r\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData.serverState); });\r\n    };\r\n    Server.prototype.onUpdateControllerData = function (cb) {\r\n        this.updateControllerCallbacks.add(cb);\r\n    };\r\n    Server.prototype.updateControllerData = function (controllerData) {\r\n        this.updateControllerCallbacks.forEach(function (e) { return e(controllerData); });\r\n    };\r\n    Server.prototype.createAndUpdatePlayer = function (data) {\r\n        var playerFound = this.playerData.find(function (pD) { return pD.id === data.id; });\r\n        if (!playerFound) {\r\n            playerFound = new index_1.PlayerData(0, 0, data.id);\r\n            this.playerData.push(playerFound);\r\n            this.startAfterFirstPlayerJoined();\r\n        }\r\n        this.updatePlayer(data);\r\n    };\r\n    Server.prototype.startAfterFirstPlayerJoined = function () {\r\n        var _this = this;\r\n        if (this.playerData.length == 1) {\r\n            this.serverData.serverState = index_1.ServerState.lobby;\r\n            this.updateServerState();\r\n            this.serverStateUpdate(30, index_1.ServerState.characterSelection, function () {\r\n                _this.serverStateUpdate(15, index_1.ServerState.running, function () {\r\n                    _this.serverStateUpdate(300, index_1.ServerState.final, function () { });\r\n                });\r\n            });\r\n        }\r\n    };\r\n    Server.prototype.serverStateUpdate = function (timerValueInSeconds, serverState, cb) {\r\n        var _this = this;\r\n        var timer = this.setAndStartTimer(timerValueInSeconds);\r\n        setTimeout(function () {\r\n            _this.serverData.serverState = serverState;\r\n            _this.updateServerState();\r\n            cb();\r\n            clearInterval(timer);\r\n        }, timerValueInSeconds);\r\n    };\r\n    Server.prototype.setAndStartTimer = function (timerValueInSeconds) {\r\n        var _this = this;\r\n        this.serverData.timerValueInSeconds = timerValueInSeconds;\r\n        return setInterval(function () {\r\n            if (_this.serverData.timerValueInSeconds)\r\n                _this.serverData.timerValueInSeconds--;\r\n            _this.sendServerData();\r\n        }, 1000);\r\n    };\r\n    Server.prototype.updatePlayer = function (updateData) {\r\n        var player = this.playerData.find(function (pD) { return pD.id === updateData.id; });\r\n        if (player) {\r\n            var playerIndex = this.playerData.indexOf(player);\r\n            this.playerData[playerIndex] = updateData;\r\n            if (updateData.playerState === index_1.PlayerState.interacting) {\r\n                //JS find Item and damage/heal\r\n                var itemFound = { damage: 0, x: 0, y: 0, objectId: 0 };\r\n                if (itemFound) {\r\n                    itemFound.damage += updateData.isAngryDad ? -1 : 1;\r\n                    if (itemFound.damage > exports.OBJECTDATAMAXHEALTH)\r\n                        itemFound.damage = exports.OBJECTDATAMAXHEALTH;\r\n                    if (itemFound.damage < 0)\r\n                        itemFound.damage = 0;\r\n                }\r\n                if (updateData.isAngryDad) {\r\n                    //check for wichtel\r\n                }\r\n            }\r\n            this.sendPlayerData();\r\n        }\r\n    };\r\n    Server.prototype.sendAllClients = function (data) {\r\n        this.airConsole.broadcast(data);\r\n    };\r\n    Server.prototype.onMessage = function () {\r\n        var _this = this;\r\n        this.airConsole.onMessage = function (from, data) {\r\n            switch (data.transactionType) {\r\n                case index_1.TransactionType.PlayerData:\r\n                    _this.createAndUpdatePlayer(data);\r\n                    break;\r\n                case index_1.TransactionType.ControllerData:\r\n                    _this.updateControllerData(data);\r\n                    //JS after change   this.updatePlayer()\r\n                    break;\r\n                default:\r\n                    console.error(\"not implemented\", data);\r\n                    break;\r\n            }\r\n            _this.sendPlayerData();\r\n        };\r\n    };\r\n    Server.prototype.subscribeToAirConsole = function () {\r\n        var _this = this;\r\n        this.onMessage();\r\n        this.airConsole.onConnect = function (id) {\r\n            _this.createAndUpdatePlayer({ id: id });\r\n            _this.sendObjectData();\r\n            _this.sendServerData();\r\n        };\r\n    };\r\n    Server.prototype.sendPlayerData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.PlayerData,\r\n            playerData: this.playerData\r\n        });\r\n    };\r\n    Server.prototype.sendObjectData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.ObjectData,\r\n            objectData: this.objectData\r\n        });\r\n    };\r\n    Server.prototype.sendServerData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.ServerData,\r\n            serverData: this.serverData\r\n        });\r\n    };\r\n    return Server;\r\n}());\r\nexports.Server = Server;\r\n\r\n\r\n\r\n},{\"./index\":2}],4:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"../common/index\");\r\nvar Views;\r\n(function (Views) {\r\n    Views[Views[\"splashscreen\"] = 0] = \"splashscreen\";\r\n    Views[Views[\"characterselection\"] = 1] = \"characterselection\";\r\n    Views[Views[\"playscreen\"] = 2] = \"playscreen\";\r\n    Views[Views[\"endscreen\"] = 3] = \"endscreen\";\r\n})(Views = exports.Views || (exports.Views = {}));\r\nvar Controller = /** @class */ (function () {\r\n    function Controller(client) {\r\n        this.client = client;\r\n        this.startPos = undefined;\r\n        this.client.onUpdateServerData(this.updateView.bind(this));\r\n    }\r\n    Controller.prototype.showView = function (view) {\r\n        document.querySelectorAll(Views[view])[0].classList.add('visible');\r\n    };\r\n    Controller.prototype.hideView = function (view) {\r\n        document.querySelectorAll(Views[view])[0].classList.remove('visible');\r\n    };\r\n    Controller.prototype.updateView = function (serverData) {\r\n        switch (serverData.serverState) {\r\n            case index_1.ServerState.lobby:\r\n                this.showView(Views.splashscreen);\r\n                this.lobby();\r\n                break;\r\n            case index_1.ServerState.characterSelection:\r\n                this.showView(Views.characterselection);\r\n                this.characterselection();\r\n                break;\r\n            case index_1.ServerState.running:\r\n                this.showView(Views.playscreen);\r\n                this.virtualController();\r\n                break;\r\n            case index_1.ServerState.final:\r\n                this.showView(Views.endscreen);\r\n                break;\r\n            default:\r\n                console.error('not implemented', serverData);\r\n        }\r\n    };\r\n    Controller.prototype.virtualController = function () {\r\n        var _this = this;\r\n        document.querySelectorAll('playscreen > controller')[0].addEventListener('touchstart', function (ev) {\r\n            _this.startPos = [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];\r\n        });\r\n        document.querySelectorAll('playscreen > controller')[0].addEventListener('touchmove', function (ev) {\r\n            if (_this.startPos !== undefined) {\r\n                _this.client.sendControllerData(new index_1.ControllerData(ev.targetTouches[0].clientX - _this.startPos[0], ev.targetTouches[0].clientY - _this.startPos[1]));\r\n            }\r\n        });\r\n        document.querySelectorAll('playscreen > controller')[0].addEventListener('touchend', function (ev) {\r\n            _this.startPos = undefined;\r\n        });\r\n    };\r\n    Controller.prototype.lobby = function () {\r\n        this.setTime(Views.splashscreen);\r\n    };\r\n    Controller.prototype.characterselection = function () {\r\n        var _this = this;\r\n        document.querySelectorAll('characterselection > button').forEach(function (btn) {\r\n            var isPlayerAngryDad = _this.client.toggleAngryDad();\r\n            if (isPlayerAngryDad) {\r\n                document.querySelectorAll('characterselection')[0].classList.add('isAngryDad');\r\n                console.log('You would like to be angry dad!');\r\n            }\r\n            else {\r\n                document.querySelectorAll('characterselection')[0].classList.remove('isAngryDad');\r\n                console.log('You would like to be a wichtel!');\r\n            }\r\n        });\r\n        this.setTime(Views.characterselection);\r\n    };\r\n    Controller.prototype.setTime = function (view) {\r\n        var _this = this;\r\n        var timeUntilInterval = setInterval(function () {\r\n            var timeUntil = _this.client.getTime();\r\n            document.querySelectorAll(Views[view] + ' > time')[0].innerHTML = timeUntil.toString();\r\n            if (timeUntil === 0) {\r\n                clearInterval(timeUntilInterval);\r\n            }\r\n        }, 1000);\r\n    };\r\n    return Controller;\r\n}());\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    var client = new index_1.Client();\r\n    var controller = new Controller(client);\r\n    var test = new index_1.ServerData(30, index_1.ServerState.lobby);\r\n    controller.updateView(test);\r\n});\r\n\r\n\r\n\r\n},{\"../common/index\":2}]},{},[4]);\r\n\r\n//# sourceMappingURL=index.js.map\r\n"]}