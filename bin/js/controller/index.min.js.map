{"version":3,"sources":["index.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","index_1","Client","prototype","onUpdateServerData","cb","this","updateServerCallbacks","add","updateServerData","_this","forEach","serverData","currentPlayerData","console","table","playerData","id","filter","pD","sendControllerData","controllerData","notifyServer","subscribeToAirConsole","airConsole","onMessage","from","dataAsString","data","JSON","parse","transactionType","TransactionType","PlayerData","log","ObjectData","objectData","ServerData","error","toggleAngryDad","currentPlayer","undefined","isAngryDad","changeAppearance","appearance","characterAppearanceType","interacting","playerState","message","AirConsole","SCREEN","stringify","getTime","timerValueInSeconds","Set","ServerState","initial","onDeviceStateChange","./index","2","__export","m","hasOwnProperty","x","y","deviceId","PlayerState","idle","CharacterAppearanceType","wichtel1","ControllerData","serverState","damage","objectId","./client","./server","3","OBJECTDATAMAXHEALTH","Server","onUpdateServerState","updateControllerCallbacks","updateServerState","onUpdateControllerData","updateControllerData","createAndUpdatePlayer","playerFound","find","updatePlayer","push","startAfterFirstPlayerJoined","lobby","serverStateUpdate","characterSelection","running","final","timer","setAndStartTimer","setTimeout","clearInterval","setAngryDad","wantAngryDads","countAngryDads","angryDadIndex","Math","floor","random","map","angryDadPlayerId_1","setInterval","updateData","player","playerIndex","indexOf","itemFound","sendAllClients","broadcast","onConnect","sendPlayerToClient","sendPlayerData","sendServerData","sendObjectData","onDisconnect","splice","4","Views","Controller","showView","view","document","querySelectorAll","classList","hideView","remove","updateView","splashscreen","characterselection","playscreen","virtualController","endscreen","addEventListener","ev","startPos","targetTouches","clientX","clientY","client","setTime","btn","timeUntilInterval","timeUntil","innerHTML","toString","bind","../common/index"],"mappings":"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","file":"index.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"./index\");\nvar Client = /** @class */ (function () {\n    function Client() {\n        var _this = this;\n        this.id = 0;\n        this.playerData = [];\n        this.objectData = [];\n        this.updateServerCallbacks = new Set();\n        this.serverData = new index_1.ServerData(30, index_1.ServerState.initial);\n        this.airConsole = new AirConsole();\n        this.airConsole.onDeviceStateChange = function (id) {\n            _this.id = id;\n            _this.subscribeToAirConsole();\n        };\n    }\n    Client.prototype.onUpdateServerData = function (cb) {\n        this.updateServerCallbacks.add(cb);\n    };\n    Client.prototype.updateServerData = function () {\n        var _this = this;\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData); });\n    };\n    Client.prototype.currentPlayerData = function () {\n        var _this = this;\n        console.table(\"currentPlayerData playerData\", this.playerData);\n        console.table(\"currentPlayerData id\", this.id);\n        return this.playerData.filter(function (pD) { return pD.id === _this.id; })[0];\n    };\n    Client.prototype.sendControllerData = function (controllerData) {\n        controllerData.id = this.id;\n        this.notifyServer(controllerData);\n    };\n    Client.prototype.subscribeToAirConsole = function () {\n        var _this = this;\n        this.airConsole.onMessage = function (from, dataAsString) {\n            if (dataAsString) {\n                var data = JSON.parse(dataAsString);\n                switch (data.transactionType) {\n                    case index_1.TransactionType.PlayerData:\n                        console.log(\"received player data\", data);\n                        _this.playerData = data.playerData;\n                        break;\n                    case index_1.TransactionType.ObjectData:\n                        console.log(\"received object data\", data);\n                        _this.objectData = data.objectData;\n                        break;\n                    case index_1.TransactionType.ServerData:\n                        console.log(\"received server data\", data);\n                        _this.serverData = data.serverData;\n                        _this.updateServerData();\n                        break;\n                    default:\n                        console.error(\"client onMessage switch\", dataAsString);\n                        break;\n                }\n            }\n            else {\n                console.error(\"client onMessage\", dataAsString);\n            }\n        };\n    };\n    Client.prototype.toggleAngryDad = function () {\n        console.table(\"toggleAngryDad playerData\", this.playerData);\n        console.table(\"toggleAngryDad id\", this.id);\n        var currentPlayer = this.currentPlayerData();\n        if (currentPlayer.isAngryDad === undefined) {\n            currentPlayer.isAngryDad = false;\n        }\n        else {\n            currentPlayer.isAngryDad = !currentPlayer.isAngryDad;\n        }\n        this.notifyServer(currentPlayer);\n        return currentPlayer.isAngryDad;\n    };\n    Client.prototype.changeAppearance = function (appearance) {\n        var currentPlayer = this.currentPlayerData();\n        currentPlayer.characterAppearanceType = appearance;\n        this.notifyServer(currentPlayer);\n        return currentPlayer.characterAppearanceType;\n    };\n    Client.prototype.interacting = function (playerState) {\n        var currentPlayer = this.currentPlayerData();\n        currentPlayer.playerState = playerState;\n        this.notifyServer(currentPlayer);\n        return currentPlayer.playerState;\n    };\n    Client.prototype.notifyServer = function (data) {\n        this.airConsole.message(AirConsole.SCREEN, JSON.stringify(data));\n    };\n    Client.prototype.getTime = function () {\n        return this.serverData.timerValueInSeconds;\n    };\n    return Client;\n}());\nexports.Client = Client;\n\n\n\n},{\"./index\":2}],2:[function(require,module,exports){\n\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./client\"));\n__export(require(\"./server\"));\nvar PlayerData = /** @class */ (function () {\n    function PlayerData(x, y, deviceId) {\n        this.x = x;\n        this.y = y;\n        this.id = deviceId;\n        this.transactionType = TransactionType.PlayerData;\n        this.playerState = PlayerState.idle;\n        this.isAngryDad = false;\n        this.characterAppearanceType = CharacterAppearanceType.wichtel1;\n    }\n    return PlayerData;\n}());\nexports.PlayerData = PlayerData;\nvar TransactionType;\n(function (TransactionType) {\n    TransactionType[TransactionType[\"ServerData\"] = 0] = \"ServerData\";\n    TransactionType[TransactionType[\"PlayerData\"] = 1] = \"PlayerData\";\n    TransactionType[TransactionType[\"ControllerData\"] = 2] = \"ControllerData\";\n    TransactionType[TransactionType[\"ObjectData\"] = 3] = \"ObjectData\";\n})(TransactionType = exports.TransactionType || (exports.TransactionType = {}));\nvar ServerState;\n(function (ServerState) {\n    ServerState[ServerState[\"initial\"] = 0] = \"initial\";\n    ServerState[ServerState[\"lobby\"] = 1] = \"lobby\";\n    ServerState[ServerState[\"characterSelection\"] = 2] = \"characterSelection\";\n    ServerState[ServerState[\"running\"] = 3] = \"running\";\n    ServerState[ServerState[\"final\"] = 4] = \"final\";\n})(ServerState = exports.ServerState || (exports.ServerState = {}));\nvar ControllerData = /** @class */ (function () {\n    function ControllerData(x, y) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        this.x = x;\n        this.y = y;\n        this.id = 0;\n        this.transactionType = TransactionType.ControllerData;\n    }\n    return ControllerData;\n}());\nexports.ControllerData = ControllerData;\nvar ServerData = /** @class */ (function () {\n    function ServerData(timerValueInSeconds, serverState) {\n        if (timerValueInSeconds === void 0) { timerValueInSeconds = 30; }\n        this.timerValueInSeconds = timerValueInSeconds;\n        this.serverState = serverState;\n    }\n    return ServerData;\n}());\nexports.ServerData = ServerData;\nvar PlayerState;\n(function (PlayerState) {\n    PlayerState[PlayerState[\"idle\"] = 0] = \"idle\";\n    PlayerState[PlayerState[\"dead\"] = 1] = \"dead\";\n    PlayerState[PlayerState[\"running\"] = 2] = \"running\";\n    PlayerState[PlayerState[\"interacting\"] = 3] = \"interacting\";\n})(PlayerState = exports.PlayerState || (exports.PlayerState = {}));\nvar CharacterAppearanceType;\n(function (CharacterAppearanceType) {\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel1\"] = 0] = \"wichtel1\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel2\"] = 1] = \"wichtel2\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel3\"] = 2] = \"wichtel3\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel4\"] = 3] = \"wichtel4\";\n})(CharacterAppearanceType = exports.CharacterAppearanceType || (exports.CharacterAppearanceType = {}));\nvar ObjectData = /** @class */ (function () {\n    function ObjectData(x, y, damage, objectId) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        if (damage === void 0) { damage = 0; }\n        this.x = x;\n        this.y = y;\n        this.damage = damage;\n        this.objectId = objectId;\n    }\n    return ObjectData;\n}());\nexports.ObjectData = ObjectData;\n\n\n\n},{\"./client\":1,\"./server\":3}],3:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"./index\");\nexports.OBJECTDATAMAXHEALTH = 10;\nvar Server = /** @class */ (function () {\n    function Server() {\n        this.playerData = [];\n        this.objectData = [];\n        this.updateServerCallbacks = new Set();\n        this.updateControllerCallbacks = new Set();\n        this.airConsole = new AirConsole();\n        this.serverData = new index_1.ServerData(30, index_1.ServerState.initial);\n        this.subscribeToAirConsole();\n    }\n    Server.prototype.onUpdateServerState = function (cb) {\n        this.updateControllerCallbacks.add(cb);\n    };\n    Server.prototype.updateServerState = function () {\n        var _this = this;\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData.serverState); });\n    };\n    Server.prototype.onUpdateControllerData = function (cb) {\n        this.updateControllerCallbacks.add(cb);\n    };\n    Server.prototype.updateControllerData = function (controllerData) {\n        this.updateControllerCallbacks.forEach(function (e) { return e(controllerData); });\n    };\n    Server.prototype.createAndUpdatePlayer = function (data) {\n        var playerFound = this.playerData.find(function (pD) { return pD.id === data.id; });\n        if (!playerFound) {\n            playerFound = new index_1.PlayerData(0, 0, data.id);\n            this.playerData.push(playerFound);\n            // this.sendPlayerData();\n            this.startAfterFirstPlayerJoined();\n        }\n        else {\n            this.updatePlayer(data);\n        }\n    };\n    Server.prototype.startAfterFirstPlayerJoined = function () {\n        var _this = this;\n        if (this.playerData.length == 1) {\n            this.serverData.serverState = index_1.ServerState.lobby;\n            this.updateServerState();\n            this.serverStateUpdate(30, index_1.ServerState.characterSelection, function () {\n                console.log(\"changed server state to character selection\");\n                _this.serverStateUpdate(15, index_1.ServerState.running, function () {\n                    _this.serverStateUpdate(300, index_1.ServerState.final, function () { });\n                });\n            });\n        }\n    };\n    Server.prototype.serverStateUpdate = function (timerValueInSeconds, serverState, cb) {\n        var _this = this;\n        var timer = this.setAndStartTimer(timerValueInSeconds);\n        setTimeout(function () {\n            clearInterval(timer);\n            _this.serverData.serverState = serverState;\n            _this.updateServerState();\n            // this.sendServerData();\n            if (_this.serverData.serverState === index_1.ServerState.running) {\n                _this.setAngryDad();\n            }\n            cb();\n        }, timerValueInSeconds * 1000);\n    };\n    Server.prototype.setAngryDad = function () {\n        var wantAngryDads = this.playerData.filter(function (pD) {\n            pD.isAngryDad;\n        });\n        var countAngryDads = wantAngryDads.length;\n        console.log(\"wantAngryDads\", wantAngryDads);\n        console.log(\"countAngryDads\", countAngryDads);\n        console.table(\"playerData\", this.playerData);\n        if (countAngryDads === 0) {\n            var angryDadIndex = Math.floor(Math.random() * this.playerData.length);\n            this.playerData.map(function (pD) { return (pD.isAngryDad = false); });\n            this.playerData[angryDadIndex].isAngryDad = true;\n        }\n        if (countAngryDads > 1) {\n            var angryDadPlayerId_1 = wantAngryDads[Math.floor(Math.random() * countAngryDads)].id;\n            this.playerData.map(function (pD) { return (pD.isAngryDad = false); });\n            this.playerData.filter(function (pD) { return pD.id === angryDadPlayerId_1; })[0].isAngryDad = true;\n        }\n        // this.sendPlayerData();\n    };\n    Server.prototype.setAndStartTimer = function (timerValueInSeconds) {\n        var _this = this;\n        this.serverData.timerValueInSeconds = timerValueInSeconds;\n        return setInterval(function () {\n            if (_this.serverData.timerValueInSeconds) {\n                _this.serverData.timerValueInSeconds--;\n                // this.sendServerData();\n            }\n        }, 1000);\n    };\n    Server.prototype.updatePlayer = function (updateData) {\n        var player = this.playerData.find(function (pD) { return pD.id === updateData.id; });\n        if (player) {\n            var playerIndex = this.playerData.indexOf(player);\n            this.playerData[playerIndex] = updateData;\n            if (updateData.playerState === index_1.PlayerState.interacting) {\n                //JS find Item and damage/heal\n                var itemFound = { damage: 0, x: 0, y: 0, objectId: 0 };\n                if (itemFound) {\n                    itemFound.damage += updateData.isAngryDad ? -1 : 1;\n                    if (itemFound.damage > exports.OBJECTDATAMAXHEALTH)\n                        itemFound.damage = exports.OBJECTDATAMAXHEALTH;\n                    if (itemFound.damage < 0)\n                        itemFound.damage = 0;\n                }\n                if (updateData.isAngryDad) {\n                    //check for wichtel\n                }\n            }\n            // this.sendPlayerData();\n        }\n    };\n    Server.prototype.sendAllClients = function (data) {\n        this.airConsole.broadcast(JSON.stringify(data));\n    };\n    Server.prototype.onMessage = function () {\n        var _this = this;\n        this.airConsole.onMessage = function (from, dataAsString) {\n            if (dataAsString) {\n                var data = JSON.parse(dataAsString);\n                switch (data.transactionType) {\n                    case index_1.TransactionType.PlayerData:\n                        _this.createAndUpdatePlayer(data);\n                        break;\n                    case index_1.TransactionType.ControllerData:\n                        _this.updateControllerData(data);\n                        //JS after change   this.updatePlayer()\n                        break;\n                    default:\n                        console.error(\"server onMessage\", dataAsString);\n                        break;\n                }\n            }\n        };\n    };\n    Server.prototype.subscribeToAirConsole = function () {\n        var _this = this;\n        this.onMessage();\n        this.airConsole.onConnect = function (id) {\n            _this.createAndUpdatePlayer({ id: id });\n            if (!_this.sendPlayerToClient) {\n                _this.sendPlayerToClient = setInterval(function () {\n                    _this.sendPlayerData();\n                    _this.sendServerData();\n                    _this.sendObjectData();\n                }, 500);\n            }\n        };\n        this.airConsole.onDisconnect = function (id) {\n            _this.playerData.splice(_this.playerData.indexOf(_this.playerData.filter(function (pD) { return pD.id === id; })[0]), 1);\n            // this.sendPlayerData();\n        };\n    };\n    Server.prototype.sendPlayerData = function () {\n        // console.table(this.playerData);\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.PlayerData,\n            playerData: this.playerData\n        });\n    };\n    Server.prototype.sendObjectData = function () {\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.ObjectData,\n            objectData: this.objectData\n        });\n    };\n    Server.prototype.sendServerData = function () {\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.ServerData,\n            serverData: this.serverData\n        });\n    };\n    return Server;\n}());\nexports.Server = Server;\n\n\n\n},{\"./index\":2}],4:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"../common/index\");\nvar Views;\n(function (Views) {\n    Views[Views[\"splashscreen\"] = 0] = \"splashscreen\";\n    Views[Views[\"characterselection\"] = 1] = \"characterselection\";\n    Views[Views[\"playscreen\"] = 2] = \"playscreen\";\n    Views[Views[\"endscreen\"] = 3] = \"endscreen\";\n})(Views = exports.Views || (exports.Views = {}));\nvar Controller = /** @class */ (function () {\n    function Controller(client) {\n        this.client = client;\n        this.startPos = undefined;\n        this.client.onUpdateServerData(this.updateView.bind(this));\n    }\n    Controller.prototype.showView = function (view) {\n        document.querySelectorAll(Views[view])[0].classList.add(\"visible\");\n    };\n    Controller.prototype.hideView = function (view) {\n        document.querySelectorAll(Views[view])[0].classList.remove(\"visible\");\n    };\n    Controller.prototype.updateView = function (serverData) {\n        console.log(\"new server state received\", index_1.ServerState[serverData.serverState]);\n        switch (serverData.serverState) {\n            case index_1.ServerState.lobby:\n                this.showView(Views.splashscreen);\n                this.lobby();\n                break;\n            case index_1.ServerState.characterSelection:\n                this.showView(Views.characterselection);\n                this.characterselection();\n                break;\n            case index_1.ServerState.running:\n                this.showView(Views.playscreen);\n                this.virtualController();\n                break;\n            case index_1.ServerState.final:\n                this.showView(Views.endscreen);\n                break;\n            default:\n                console.error(\"not implemented\", serverData);\n        }\n    };\n    Controller.prototype.virtualController = function () {\n        var _this = this;\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchstart\", function (ev) {\n            _this.startPos = [\n                ev.targetTouches[0].clientX,\n                ev.targetTouches[0].clientY\n            ];\n        });\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchmove\", function (ev) {\n            if (_this.startPos !== undefined) {\n                _this.client.sendControllerData(new index_1.ControllerData(ev.targetTouches[0].clientX - _this.startPos[0], ev.targetTouches[0].clientY - _this.startPos[1]));\n            }\n        });\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchend\", function (ev) {\n            _this.startPos = undefined;\n        });\n    };\n    Controller.prototype.lobby = function () {\n        this.setTime(Views.splashscreen);\n    };\n    Controller.prototype.characterselection = function () {\n        var _this = this;\n        document.querySelectorAll(\"characterselection > button\").forEach(function (btn) {\n            var isPlayerAngryDad = _this.client.toggleAngryDad();\n            if (isPlayerAngryDad) {\n                document\n                    .querySelectorAll(\"characterselection\")[0]\n                    .classList.add(\"isAngryDad\");\n                console.log(\"You would like to be angry dad!\");\n            }\n            else {\n                document\n                    .querySelectorAll(\"characterselection\")[0]\n                    .classList.remove(\"isAngryDad\");\n                console.log(\"You would like to be a wichtel!\");\n            }\n        });\n        this.setTime(Views.characterselection);\n    };\n    Controller.prototype.setTime = function (view) {\n        var _this = this;\n        var timeUntilInterval = setInterval(function () {\n            var timeUntil = _this.client.getTime();\n            document.querySelectorAll(Views[view] + \" > time\")[0].innerHTML = timeUntil.toString();\n            if (timeUntil === 0) {\n                clearInterval(timeUntilInterval);\n            }\n        }, 1000);\n    };\n    return Controller;\n}());\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    var client = new index_1.Client();\n    var controller = new Controller(client);\n    //let test = new ServerData(30, ServerState.lobby);\n    //controller.updateView(test);\n});\n\n\n\n},{\"../common/index\":2}]},{},[4]);\n\n//# sourceMappingURL=index.js.map\n"]}