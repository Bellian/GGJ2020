{"version":3,"sources":["index.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","index_1","eventListener_1","connectedDevice_1","eventListener","EventListener","get","Client","prototype","initMessageHandler","this","airConsole","onMessage","from","data","console","log","event_1","action","trigger","onUpdateServerData","cb","updateServerCallbacks","add","updateServerData","_this","forEach","serverData","currentPlayerData","table","playerData","id","filter","pD","sendControllerData","controllerData","notifyServer","subscribeToAirConsole","transactionType","TransactionType","PlayerData","ObjectData","objectData","ServerData","error","toggleAngryDad","currentPlayer","undefined","isAngryDad","changeAppearance","appearance","characterAppearanceType","interacting","playerState","message","AirConsole","SCREEN","getTime","timerValueInSeconds","Set","ServerState","initial","awaitReady","Promise","resolve","onDeviceStateChange","state","getDevice","updateState","ConnectedDevice","on","setCustomDeviceState","wantAngry","Math","random","./connectedDevice","./eventListener","./index","2","__read","m","Symbol","iterator","ar","next","done","push","__spread","arguments","concat","deviceLib","Map","deviceId","has","getAllDevices","values","internalID","disconnect","delete","stateData","updateCustomState","customStateData","toJson","set","3","instance","event","callback","listener","off","index","indexOf","splice","4","__export","hasOwnProperty","x","y","PlayerState","idle","CharacterAppearanceType","wichtel1","ControllerData","serverState","damage","objectId","./client","./server","5","gameStateJoin_1","OBJECTDATAMAXHEALTH","Server","initTick","time","performance","now","setInterval","newTime","delta","gameState","tick","onConnect","onDisconnect","onCustomDeviceStateChange","onUpdateServerState","updateControllerCallbacks","updateServerState","onUpdateControllerData","updateControllerData","createAndUpdatePlayer","playerFound","find","updatePlayer","startAfterFirstPlayerJoined","lobby","serverStateUpdate","characterSelection","running","final","setTimeout","setAngryDad","wantAngryDads","countAngryDads","angryDadIndex","floor","map","angryDadPlayerId_1","updateData","player","playerIndex","itemFound","sendAllClients","broadcast","sendPlayerData","sendObjectData","sendServerData","GameStateJoin","./server/gameStateJoin","6","GameState","enter","exit","newState","nextState","server","onExit","../eventListener","7","extendStatics","__extends","d","b","setPrototypeOf","__proto__","Array","__","constructor","create","_super","gameState_1","GameStateChoose","startTimer","timerStarted","duration","Date","angry","devices","candidates","../connectedDevice","./gameState","8","gameStateChoose_1","deviceJoinedCallback","device","setActivePlayers","./gameStateChoose","9","Views","Controller","showView","view","document","querySelectorAll","classList","hideView","remove","updateView","splashscreen","characterselection","playscreen","virtualController","endscreen","addEventListener","ev","startPos","targetTouches","clientX","clientY","client","setTime","btn","timeUntilInterval","timeUntil","innerHTML","toString","clearInterval","bind","../common/index"],"mappings":"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","file":"index.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"./index\");\nvar eventListener_1 = require(\"./eventListener\");\nvar connectedDevice_1 = require(\"./connectedDevice\");\nvar eventListener = eventListener_1.EventListener.get();\nvar Client = /** @class */ (function () {\n    function Client() {\n        var _this = this;\n        this.id = 0;\n        this.playerData = [];\n        this.objectData = [];\n        this.updateServerCallbacks = new Set();\n        this.serverData = new index_1.ServerData(30, index_1.ServerState.initial);\n        this.awaitReady = new Promise(function (resolve) {\n            _this.airConsole = new AirConsole();\n            _this.initMessageHandler();\n            _this.airConsole.onDeviceStateChange = function (id, state) {\n                try {\n                    connectedDevice_1.getDevice(id).updateState(state);\n                }\n                catch (e) {\n                    var newDevice = new connectedDevice_1.ConnectedDevice(id);\n                    newDevice.updateState(state);\n                }\n            };\n            eventListener.on('SERVER_updateState', function (state) {\n                console.log('game state changed', state.state);\n                if (state.state === 'join') {\n                    // prepare stuff for join state\n                }\n                if (state.state === 'choose') {\n                    // prepare stuff for choose state\n                    _this.airConsole.setCustomDeviceState({\n                        wantAngry: Math.random() > 0.5,\n                    });\n                }\n            });\n        });\n    }\n    Client.prototype.initMessageHandler = function () {\n        this.airConsole.onMessage = function (from, data) {\n            if (data) {\n                if (from === 0) {\n                    console.log('Got message from server', data);\n                    var event_1 = 'SERVER_' + data.action;\n                    eventListener.trigger(event_1, data.data);\n                }\n                else {\n                    // IDK\n                }\n            }\n        };\n    };\n    Client.prototype.onUpdateServerData = function (cb) {\n        this.updateServerCallbacks.add(cb);\n    };\n    Client.prototype.updateServerData = function () {\n        var _this = this;\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData); });\n    };\n    Client.prototype.currentPlayerData = function () {\n        var _this = this;\n        console.table(\"currentPlayerData playerData\", this.playerData);\n        console.table(\"currentPlayerData id\", this.id);\n        return this.playerData.filter(function (pD) { return pD.id === _this.id; })[0];\n    };\n    Client.prototype.sendControllerData = function (controllerData) {\n        controllerData.id = this.id;\n        this.notifyServer(controllerData);\n    };\n    Client.prototype.subscribeToAirConsole = function () {\n        var _this = this;\n        this.airConsole.onMessage = function (from, data) {\n            if (data) {\n                switch (data.transactionType) {\n                    case index_1.TransactionType.PlayerData:\n                        console.log(\"received player data\", data);\n                        _this.playerData = data.playerData;\n                        break;\n                    case index_1.TransactionType.ObjectData:\n                        // console.log(\"received object data\", data);\n                        _this.objectData = data.objectData;\n                        break;\n                    case index_1.TransactionType.ServerData:\n                        // console.log(\"received server data\", data);\n                        _this.serverData = data.serverData;\n                        _this.updateServerData();\n                        break;\n                    default:\n                        console.error(\"client onMessage switch\", data);\n                        break;\n                }\n            }\n            else {\n                console.error(\"client onMessage\", data);\n            }\n        };\n    };\n    Client.prototype.toggleAngryDad = function () {\n        console.table(\"toggleAngryDad playerData\", this.playerData);\n        console.table(\"toggleAngryDad id\", this.id);\n        var currentPlayer = this.currentPlayerData();\n        if (currentPlayer.isAngryDad === undefined) {\n            currentPlayer.isAngryDad = false;\n        }\n        else {\n            currentPlayer.isAngryDad = !currentPlayer.isAngryDad;\n        }\n        this.notifyServer(currentPlayer);\n        return currentPlayer.isAngryDad;\n    };\n    Client.prototype.changeAppearance = function (appearance) {\n        var currentPlayer = this.currentPlayerData();\n        currentPlayer.characterAppearanceType = appearance;\n        this.notifyServer(currentPlayer);\n        return currentPlayer.characterAppearanceType;\n    };\n    Client.prototype.interacting = function (playerState) {\n        var currentPlayer = this.currentPlayerData();\n        currentPlayer.playerState = playerState;\n        this.notifyServer(currentPlayer);\n        return currentPlayer.playerState;\n    };\n    Client.prototype.notifyServer = function (data) {\n        this.airConsole.message(AirConsole.SCREEN, data);\n    };\n    Client.prototype.getTime = function () {\n        return this.serverData.timerValueInSeconds;\n    };\n    return Client;\n}());\nexports.Client = Client;\n\n\n\n},{\"./connectedDevice\":2,\"./eventListener\":3,\"./index\":4}],2:[function(require,module,exports){\n\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar eventListener_1 = require(\"./eventListener\");\nvar eventListener = eventListener_1.EventListener.get();\nvar deviceLib = new Map();\nfunction getDevice(deviceId) {\n    if (!deviceLib.has(deviceId)) {\n        throw new Error('The device does not exist: ' + deviceId);\n    }\n    return deviceLib.get(deviceId);\n}\nexports.getDevice = getDevice;\nfunction getAllDevices() {\n    return __spread(deviceLib.values());\n}\nexports.getAllDevices = getAllDevices;\nvar internalID = 0;\nvar ConnectedDevice = /** @class */ (function () {\n    function ConnectedDevice(deviceId) {\n        this.deviceId = deviceId;\n        this.internalID = internalID++;\n        console.log('client connected', deviceId);\n        deviceLib.set(deviceId, this);\n        eventListener.trigger('deviceJoined', this);\n    }\n    ConnectedDevice.prototype.disconnect = function () {\n        deviceLib.delete(this.deviceId);\n        eventListener.trigger('deviceDisconnected', this);\n    };\n    ConnectedDevice.prototype.updateState = function (data) {\n        console.log('update state');\n        this.stateData = data;\n    };\n    ConnectedDevice.prototype.updateCustomState = function (data) {\n        console.log('update custom state');\n        this.customStateData = data;\n    };\n    ConnectedDevice.prototype.toJson = function () {\n        return {\n            internalID: this.internalID,\n            deviceId: this.deviceId,\n        };\n    };\n    return ConnectedDevice;\n}());\nexports.ConnectedDevice = ConnectedDevice;\n\n\n\n},{\"./eventListener\":3}],3:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EventListener = /** @class */ (function () {\n    function EventListener() {\n        this.listener = {};\n    }\n    EventListener.get = function () {\n        if (this.instance === undefined) {\n            this.instance = new EventListener();\n        }\n        return this.instance;\n    };\n    EventListener.prototype.on = function (event, callback) {\n        if (this.listener[event] === undefined) {\n            this.listener[event] = [];\n        }\n        this.listener[event].push(callback);\n        return callback;\n    };\n    EventListener.prototype.off = function (event, callback) {\n        if (this.listener[event] !== undefined) {\n            var index = this.listener[event].indexOf(callback);\n            if (index !== -1) {\n                this.listener[event].splice(index, 1);\n            }\n        }\n        return callback;\n    };\n    EventListener.prototype.trigger = function (event, data) {\n        if (this.listener[event] !== undefined) {\n            this.listener[event].forEach(function (e) { return e(data); });\n        }\n    };\n    return EventListener;\n}());\nexports.EventListener = EventListener;\n\n\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./client\"));\n__export(require(\"./server\"));\nvar PlayerData = /** @class */ (function () {\n    function PlayerData(x, y, deviceId) {\n        this.x = x;\n        this.y = y;\n        this.id = deviceId;\n        this.transactionType = TransactionType.PlayerData;\n        this.playerState = PlayerState.idle;\n        this.isAngryDad = false;\n        this.characterAppearanceType = CharacterAppearanceType.wichtel1;\n    }\n    return PlayerData;\n}());\nexports.PlayerData = PlayerData;\nvar TransactionType;\n(function (TransactionType) {\n    TransactionType[TransactionType[\"ServerData\"] = 0] = \"ServerData\";\n    TransactionType[TransactionType[\"PlayerData\"] = 1] = \"PlayerData\";\n    TransactionType[TransactionType[\"ControllerData\"] = 2] = \"ControllerData\";\n    TransactionType[TransactionType[\"ObjectData\"] = 3] = \"ObjectData\";\n})(TransactionType = exports.TransactionType || (exports.TransactionType = {}));\nvar ServerState;\n(function (ServerState) {\n    ServerState[ServerState[\"initial\"] = 0] = \"initial\";\n    ServerState[ServerState[\"lobby\"] = 1] = \"lobby\";\n    ServerState[ServerState[\"characterSelection\"] = 2] = \"characterSelection\";\n    ServerState[ServerState[\"running\"] = 3] = \"running\";\n    ServerState[ServerState[\"final\"] = 4] = \"final\";\n})(ServerState = exports.ServerState || (exports.ServerState = {}));\nvar ControllerData = /** @class */ (function () {\n    function ControllerData(x, y) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        this.x = x;\n        this.y = y;\n        this.id = 0;\n        this.transactionType = TransactionType.ControllerData;\n    }\n    return ControllerData;\n}());\nexports.ControllerData = ControllerData;\nvar ServerData = /** @class */ (function () {\n    function ServerData(timerValueInSeconds, serverState) {\n        if (timerValueInSeconds === void 0) { timerValueInSeconds = 30; }\n        this.timerValueInSeconds = timerValueInSeconds;\n        this.serverState = serverState;\n    }\n    return ServerData;\n}());\nexports.ServerData = ServerData;\nvar PlayerState;\n(function (PlayerState) {\n    PlayerState[PlayerState[\"idle\"] = 0] = \"idle\";\n    PlayerState[PlayerState[\"dead\"] = 1] = \"dead\";\n    PlayerState[PlayerState[\"running\"] = 2] = \"running\";\n    PlayerState[PlayerState[\"interacting\"] = 3] = \"interacting\";\n})(PlayerState = exports.PlayerState || (exports.PlayerState = {}));\nvar CharacterAppearanceType;\n(function (CharacterAppearanceType) {\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel1\"] = 0] = \"wichtel1\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel2\"] = 1] = \"wichtel2\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel3\"] = 2] = \"wichtel3\";\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel4\"] = 3] = \"wichtel4\";\n})(CharacterAppearanceType = exports.CharacterAppearanceType || (exports.CharacterAppearanceType = {}));\nvar ObjectData = /** @class */ (function () {\n    function ObjectData(x, y, damage, objectId) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        if (damage === void 0) { damage = 0; }\n        this.x = x;\n        this.y = y;\n        this.damage = damage;\n        this.objectId = objectId;\n    }\n    return ObjectData;\n}());\nexports.ObjectData = ObjectData;\n\n\n\n},{\"./client\":1,\"./server\":5}],5:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"./index\");\nvar connectedDevice_1 = require(\"./connectedDevice\");\nvar eventListener_1 = require(\"./eventListener\");\nvar gameStateJoin_1 = require(\"./server/gameStateJoin\");\nvar eventListener = eventListener_1.EventListener.get();\nexports.OBJECTDATAMAXHEALTH = 10;\nvar Server = /** @class */ (function () {\n    function Server() {\n        var _this = this;\n        this.playerData = [];\n        this.objectData = [];\n        this.updateServerCallbacks = new Set();\n        this.updateControllerCallbacks = new Set();\n        this.airConsole = new AirConsole();\n        this.serverData = new index_1.ServerData(30, index_1.ServerState.initial);\n        this.subscribeToAirConsole();\n        this.gameState = new gameStateJoin_1.GameStateJoin(this, 3000);\n        eventListener.on('newGameState', function (state) {\n            _this.gameState = state;\n        });\n        this.initTick();\n        this.initMessageHandler();\n    }\n    Server.prototype.initTick = function () {\n        var _this = this;\n        var time = performance.now();\n        setInterval(function () {\n            var newTime = performance.now();\n            var delta = newTime - time;\n            time = newTime;\n            _this.gameState.tick(delta);\n        }, 1000 / 60);\n    };\n    Server.prototype.initMessageHandler = function () {\n        this.airConsole.onMessage = function (from, data) {\n            if (data) {\n                eventListener.trigger('airConsoleMessage', [from, data]);\n            }\n        };\n    };\n    Server.prototype.subscribeToAirConsole = function () {\n        this.airConsole.onConnect = function (id) {\n        };\n        this.airConsole.onDisconnect = function (id) {\n            connectedDevice_1.getDevice(id).disconnect();\n        };\n        this.airConsole.onDeviceStateChange = function (id, data) {\n            try {\n                connectedDevice_1.getDevice(id).updateState(data);\n            }\n            catch (e) {\n                var newDevice = new connectedDevice_1.ConnectedDevice(id);\n                newDevice.updateState(data);\n            }\n        };\n        this.airConsole.onCustomDeviceStateChange = function (id, data) {\n            try {\n                connectedDevice_1.getDevice(id).updateCustomState(data);\n            }\n            catch (e) {\n                var newDevice = new connectedDevice_1.ConnectedDevice(id);\n                newDevice.updateCustomState(data);\n            }\n        };\n    };\n    Server.prototype.onUpdateServerState = function (cb) {\n        this.updateControllerCallbacks.add(cb);\n    };\n    Server.prototype.updateServerState = function () {\n        var _this = this;\n        this.updateServerCallbacks.forEach(function (e) { return e(_this.serverData.serverState); });\n    };\n    Server.prototype.onUpdateControllerData = function (cb) {\n        this.updateControllerCallbacks.add(cb);\n    };\n    Server.prototype.updateControllerData = function (controllerData) {\n        this.updateControllerCallbacks.forEach(function (e) { return e(controllerData); });\n    };\n    Server.prototype.createAndUpdatePlayer = function (data) {\n        var playerFound = this.playerData.find(function (pD) { return pD.id === data.id; });\n        if (!playerFound) {\n            playerFound = new index_1.PlayerData(0, 0, data.id);\n            this.playerData.push(playerFound);\n            // this.sendPlayerData();\n            this.startAfterFirstPlayerJoined();\n        }\n        else {\n            this.updatePlayer(data);\n        }\n    };\n    Server.prototype.startAfterFirstPlayerJoined = function () {\n        var _this = this;\n        if (this.playerData.length == 1) {\n            this.serverData.serverState = index_1.ServerState.lobby;\n            this.updateServerState();\n            this.serverStateUpdate(30, index_1.ServerState.characterSelection, function () {\n                console.log(\"changed server state to character selection\");\n                _this.serverStateUpdate(15, index_1.ServerState.running, function () {\n                    _this.serverStateUpdate(300, index_1.ServerState.final, function () { });\n                });\n            });\n        }\n    };\n    Server.prototype.serverStateUpdate = function (timerValueInSeconds, serverState, cb) {\n        var _this = this;\n        setTimeout(function () {\n            _this.serverData.serverState = serverState;\n            _this.updateServerState();\n            // this.sendServerData();\n            if (_this.serverData.serverState === index_1.ServerState.running) {\n                _this.setAngryDad();\n            }\n            cb();\n        }, timerValueInSeconds * 1000);\n    };\n    Server.prototype.setAngryDad = function () {\n        var wantAngryDads = this.playerData.filter(function (pD) {\n            pD.isAngryDad;\n        });\n        var countAngryDads = wantAngryDads.length;\n        console.log(\"wantAngryDads\", wantAngryDads);\n        console.log(\"countAngryDads\", countAngryDads);\n        console.table(\"playerData\", this.playerData);\n        if (countAngryDads === 0) {\n            var angryDadIndex = Math.floor(Math.random() * this.playerData.length);\n            this.playerData.map(function (pD) { return (pD.isAngryDad = false); });\n            this.playerData[angryDadIndex].isAngryDad = true;\n        }\n        if (countAngryDads > 1) {\n            var angryDadPlayerId_1 = wantAngryDads[Math.floor(Math.random() * countAngryDads)].id;\n            this.playerData.map(function (pD) { return (pD.isAngryDad = false); });\n            this.playerData.filter(function (pD) { return pD.id === angryDadPlayerId_1; })[0].isAngryDad = true;\n        }\n        // this.sendPlayerData();\n    };\n    Server.prototype.updatePlayer = function (updateData) {\n        var player = this.playerData.find(function (pD) { return pD.id === updateData.id; });\n        if (player) {\n            var playerIndex = this.playerData.indexOf(player);\n            this.playerData[playerIndex] = updateData;\n            if (updateData.playerState === index_1.PlayerState.interacting) {\n                //JS find Item and damage/heal\n                var itemFound = { damage: 0, x: 0, y: 0, objectId: 0 };\n                if (itemFound) {\n                    itemFound.damage += updateData.isAngryDad ? -1 : 1;\n                    if (itemFound.damage > exports.OBJECTDATAMAXHEALTH)\n                        itemFound.damage = exports.OBJECTDATAMAXHEALTH;\n                    if (itemFound.damage < 0)\n                        itemFound.damage = 0;\n                }\n                if (updateData.isAngryDad) {\n                    //check for wichtel\n                }\n            }\n            // this.sendPlayerData();\n        }\n    };\n    Server.prototype.sendAllClients = function (data) {\n        this.airConsole.broadcast(data);\n    };\n    /*\n    private onMessage() {\n      this.airConsole.onMessage = (from: any, data: any) => {\n        if (data) {\n          switch (data.transactionType) {\n            case TransactionType.PlayerData:\n              debugger;\n              this.createAndUpdatePlayer(data as PlayerData);\n              break;\n            case TransactionType.ControllerData:\n              this.updateControllerData(data as ControllerData);\n              //JS after change   this.updatePlayer()\n              break;\n            default:\n              console.error(\"server onMessage\", data);\n              break;\n          }\n        }\n      };\n    }\n  */\n    Server.prototype.sendPlayerData = function () {\n        // console.table(this.playerData);\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.PlayerData,\n            playerData: this.playerData\n        });\n    };\n    Server.prototype.sendObjectData = function () {\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.ObjectData,\n            objectData: this.objectData\n        });\n    };\n    Server.prototype.sendServerData = function () {\n        this.sendAllClients({\n            transactionType: index_1.TransactionType.ServerData,\n            serverData: this.serverData\n        });\n    };\n    return Server;\n}());\nexports.Server = Server;\n\n\n\n},{\"./connectedDevice\":2,\"./eventListener\":3,\"./index\":4,\"./server/gameStateJoin\":8}],6:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar eventListener_1 = require(\"../eventListener\");\nvar eventListener = eventListener_1.EventListener.get();\nvar GameState = /** @class */ (function () {\n    function GameState(server) {\n        this.server = server;\n        this.enter();\n    }\n    GameState.prototype.tick = function (delta) {\n    };\n    GameState.prototype.enter = function () {\n    };\n    ;\n    GameState.prototype.exit = function () {\n        var newState = new this.nextState(this.server);\n        eventListener.trigger('newGameState', newState);\n    };\n    GameState.prototype.onExit = function (cb) {\n        this.callback = cb;\n    };\n    return GameState;\n}());\nexports.GameState = GameState;\n\n\n\n},{\"../eventListener\":3}],7:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar gameState_1 = require(\"./gameState\");\nvar eventListener_1 = require(\"../eventListener\");\nvar connectedDevice_1 = require(\"../connectedDevice\");\nvar eventListener = eventListener_1.EventListener.get();\nvar duration = 3000;\nvar GameStateChoose = /** @class */ (function (_super) {\n    __extends(GameStateChoose, _super);\n    function GameStateChoose(server) {\n        var _this = _super.call(this, server) || this;\n        //nextState = undefined;\n        _this.duration = duration;\n        _this.nextState = gameState_1.GameState;\n        return _this;\n    }\n    GameStateChoose.prototype.enter = function () {\n        this.startTimer();\n        this.server.airConsole.broadcast({\n            action: 'updateState',\n            data: {\n                state: 'choose',\n                timerStarted: this.timerStarted,\n                duration: duration,\n            }\n        });\n    };\n    GameStateChoose.prototype.tick = function (delta) {\n        if (this.timerStarted === undefined) {\n            return;\n        }\n        var timeLeft = this.duration - (Date.now() - this.timerStarted);\n        if (timeLeft <= 0) {\n            console.log('timer is up, next state');\n            this.exit();\n        }\n    };\n    GameStateChoose.prototype.exit = function () {\n        var angry = undefined;\n        var devices = connectedDevice_1.getAllDevices();\n        var candidates = devices.filter(function (e) { return e.customStateData.wantAngry; });\n        if (candidates.length === 0) {\n            // fuck u all and pick random\n            angry = devices[devices.length * Math.random()];\n        }\n        else {\n            angry = candidates[candidates.length * Math.random()];\n        }\n        console.log('and the winner is:', angry);\n        connectedDevice_1.getAllDevices().forEach(function (e) {\n            console.log(e.customStateData);\n        });\n        _super.prototype.exit.call(this);\n    };\n    GameStateChoose.prototype.startTimer = function () {\n        console.log('player joined, starting timer');\n        this.timerStarted = Date.now();\n    };\n    return GameStateChoose;\n}(gameState_1.GameState));\nexports.GameStateChoose = GameStateChoose;\n\n\n\n},{\"../connectedDevice\":2,\"../eventListener\":3,\"./gameState\":6}],8:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar gameState_1 = require(\"./gameState\");\nvar eventListener_1 = require(\"../eventListener\");\nvar gameStateChoose_1 = require(\"./gameStateChoose\");\nvar eventListener = eventListener_1.EventListener.get();\nvar GameStateJoin = /** @class */ (function (_super) {\n    __extends(GameStateJoin, _super);\n    function GameStateJoin(server, duration) {\n        var _this = _super.call(this, server) || this;\n        _this.duration = duration;\n        //nextState = undefined;\n        _this.nextState = gameStateChoose_1.GameStateChoose;\n        return _this;\n    }\n    GameStateJoin.prototype.tick = function (delta) {\n        if (this.timerStarted === undefined) {\n            return;\n        }\n        var timeLeft = this.duration - (Date.now() - this.timerStarted);\n        if (timeLeft <= 0) {\n            console.log('timer is up, next state');\n            this.exit();\n        }\n    };\n    GameStateJoin.prototype.enter = function () {\n        var _this = this;\n        this.deviceJoinedCallback = eventListener.on('deviceJoined', function (device) {\n            if (!_this.timerStarted) {\n                _this.startTimer();\n            }\n            _this.server.airConsole.message(device.deviceId, {\n                action: 'updateState',\n                data: {\n                    state: 'join',\n                    timerStarted: _this.timerStarted,\n                    duration: _this.duration,\n                }\n            });\n        });\n    };\n    GameStateJoin.prototype.exit = function () {\n        eventListener.off('deviceJoined', this.deviceJoinedCallback);\n        this.server.airConsole.setActivePlayers(4);\n        _super.prototype.exit.call(this);\n    };\n    GameStateJoin.prototype.startTimer = function () {\n        console.log('player joined, starting timer');\n        this.timerStarted = Date.now();\n    };\n    return GameStateJoin;\n}(gameState_1.GameState));\nexports.GameStateJoin = GameStateJoin;\n\n\n\n},{\"../eventListener\":3,\"./gameState\":6,\"./gameStateChoose\":7}],9:[function(require,module,exports){\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"../common/index\");\nvar Views;\n(function (Views) {\n    Views[Views[\"splashscreen\"] = 0] = \"splashscreen\";\n    Views[Views[\"characterselection\"] = 1] = \"characterselection\";\n    Views[Views[\"playscreen\"] = 2] = \"playscreen\";\n    Views[Views[\"endscreen\"] = 3] = \"endscreen\";\n})(Views = exports.Views || (exports.Views = {}));\nvar Controller = /** @class */ (function () {\n    function Controller(client) {\n        this.client = client;\n        this.startPos = undefined;\n        this.client.onUpdateServerData(this.updateView.bind(this));\n    }\n    Controller.prototype.showView = function (view) {\n        document.querySelectorAll(Views[view])[0].classList.add(\"visible\");\n    };\n    Controller.prototype.hideView = function (view) {\n        document.querySelectorAll(Views[view])[0].classList.remove(\"visible\");\n    };\n    Controller.prototype.updateView = function (serverData) {\n        console.log(\"new server state received\", index_1.ServerState[serverData.serverState]);\n        switch (serverData.serverState) {\n            case index_1.ServerState.lobby:\n                this.showView(Views.splashscreen);\n                this.lobby();\n                break;\n            case index_1.ServerState.characterSelection:\n                this.showView(Views.characterselection);\n                this.characterselection();\n                break;\n            case index_1.ServerState.running:\n                this.showView(Views.playscreen);\n                this.virtualController();\n                break;\n            case index_1.ServerState.final:\n                this.showView(Views.endscreen);\n                break;\n            default:\n                console.error(\"not implemented\", serverData);\n        }\n    };\n    Controller.prototype.virtualController = function () {\n        var _this = this;\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchstart\", function (ev) {\n            _this.startPos = [\n                ev.targetTouches[0].clientX,\n                ev.targetTouches[0].clientY\n            ];\n        });\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchmove\", function (ev) {\n            if (_this.startPos !== undefined) {\n                _this.client.sendControllerData(new index_1.ControllerData(ev.targetTouches[0].clientX - _this.startPos[0], ev.targetTouches[0].clientY - _this.startPos[1]));\n            }\n        });\n        document\n            .querySelectorAll(\"playscreen > controller\")[0]\n            .addEventListener(\"touchend\", function (ev) {\n            _this.startPos = undefined;\n        });\n    };\n    Controller.prototype.lobby = function () {\n        this.setTime(Views.splashscreen);\n    };\n    Controller.prototype.characterselection = function () {\n        var _this = this;\n        document.querySelectorAll(\"characterselection > button\").forEach(function (btn) {\n            var isPlayerAngryDad = _this.client.toggleAngryDad();\n            if (isPlayerAngryDad) {\n                document\n                    .querySelectorAll(\"characterselection\")[0]\n                    .classList.add(\"isAngryDad\");\n                console.log(\"You would like to be angry dad!\");\n            }\n            else {\n                document\n                    .querySelectorAll(\"characterselection\")[0]\n                    .classList.remove(\"isAngryDad\");\n                console.log(\"You would like to be a wichtel!\");\n            }\n        });\n        this.setTime(Views.characterselection);\n    };\n    Controller.prototype.setTime = function (view) {\n        var _this = this;\n        var timeUntilInterval = setInterval(function () {\n            var timeUntil = _this.client.getTime();\n            document.querySelectorAll(Views[view] + \" > time\")[0].innerHTML = timeUntil.toString();\n            if (timeUntil === 0) {\n                clearInterval(timeUntilInterval);\n            }\n        }, 1000);\n    };\n    return Controller;\n}());\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    var client = new index_1.Client();\n    var controller = new Controller(client);\n    //let test = new ServerData(30, ServerState.lobby);\n    //controller.updateView(test);\n});\n\n\n\n},{\"../common/index\":4}]},{},[9]);\n\n//# sourceMappingURL=index.js.map\n"]}