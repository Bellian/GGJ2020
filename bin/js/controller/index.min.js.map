{"version":3,"sources":["index.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Object","defineProperty","value","index_1","Client","prototype","currentPlayerData","_this","this","playerData","filter","pD","id","sendControllerData","controllerData","notifyServer","subscribeToAirConsole","airconsole","onMessage","from","data","transactionType","TransactionType","PlayerData","ObjectData","objectData","ServerData","serverData","updateServerData","console","error","toggleAngryDad","currentPlayer","undefined","isAngryDad","changeAppearance","appearance","characterAppearanceType","message","AirConsole","SCREEN","JSON","stringify","getTime","timerValueInSeconds","cb","getDeviceId","./index","2","__export","m","hasOwnProperty","x","y","deviceId","playerState","PlayerState","idle","CharacterAppearanceType","wichtel1","ServerState","ControllerData","serverState","initial","./client","./server","3","Server","createAndUpdatePlayer","playerFound","find","push","startAfterFirstPlayerJoined","updatePlayer","lobby","updateServerState","serverStateUpdate","characterSelection","running","final","timer","setAndStartTimer","setTimeout","clearInterval","setInterval","sendServerData","updateData","sendPlayerData","sendAllClients","airConsole","broadcast","updateControllerData","onConnect","sendObjectData","4","Views","Controller","client","startPos","document","addEventListener","virtualController","onUpdateServerData","updateView","bind","showView","view","querySelectorAll","classList","add","hideView","remove","splashscreen","characterselection","playscreen","endscreen","ev","log","targetTouches","clientX","clientY","forEach","btn","character","isPlayerAngryDad","innerHTML","timeUntilStartInterval","timeUntilStart","toString","../common/index"],"mappings":"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","file":"index.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"./index\");\r\nvar Client = /** @class */ (function () {\r\n    function Client() {\r\n        var _this = this;\r\n        this.id = 0;\r\n        this.playerData = [];\r\n        this.objectData = [];\r\n        this.serverData = new index_1.ServerData();\r\n        this.updateServerData = function () { return function (cb) {\r\n            cb(_this.serverData);\r\n        }; };\r\n        if (!this.id)\r\n            this.id = this.airconsole.getDeviceId();\r\n        this.airconsole = new AirConsole();\r\n        this.subscribeToAirConsole();\r\n    }\r\n    Client.prototype.currentPlayerData = function () {\r\n        var _this = this;\r\n        return this.playerData.filter(function (pD) { return pD.id === _this.id; })[0];\r\n    };\r\n    Client.prototype.sendControllerData = function (controllerData) {\r\n        controllerData.id = this.id;\r\n        this.notifyServer(controllerData);\r\n    };\r\n    Client.prototype.subscribeToAirConsole = function () {\r\n        var _this = this;\r\n        this.airconsole.onMessage = function (from, data) {\r\n            switch (data.transactionType) {\r\n                case index_1.TransactionType.PlayerData:\r\n                    _this.playerData = data.playerData;\r\n                    break;\r\n                case index_1.TransactionType.ObjectData:\r\n                    _this.objectData = data.objectData;\r\n                    break;\r\n                case index_1.TransactionType.ServerData:\r\n                    _this.serverData = data.serverData;\r\n                    _this.updateServerData();\r\n                    break;\r\n                default:\r\n                    console.error(\"not implemented\", data);\r\n                    break;\r\n            }\r\n        };\r\n    };\r\n    Client.prototype.toggleAngryDad = function () {\r\n        var currentPlayer = this.currentPlayerData();\r\n        if (currentPlayer.isAngryDad === undefined) {\r\n            currentPlayer.isAngryDad = false;\r\n        }\r\n        else {\r\n            currentPlayer.isAngryDad = !currentPlayer.isAngryDad;\r\n        }\r\n        this.notifyServer(currentPlayer);\r\n        return currentPlayer.isAngryDad;\r\n    };\r\n    Client.prototype.changeAppearance = function (appearance) {\r\n        var currentPlayer = this.currentPlayerData();\r\n        currentPlayer.characterAppearanceType = appearance;\r\n        this.notifyServer(currentPlayer);\r\n        return currentPlayer.characterAppearanceType;\r\n    };\r\n    Client.prototype.notifyServer = function (data) {\r\n        this.airconsole.message(AirConsole.SCREEN, JSON.stringify(data));\r\n    };\r\n    Client.prototype.getTime = function () {\r\n        return this.serverData.timerValueInSeconds;\r\n    };\r\n    return Client;\r\n}());\r\nexports.Client = Client;\r\n\r\n\r\n\r\n},{\"./index\":2}],2:[function(require,module,exports){\r\n\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./client\"));\r\n__export(require(\"./server\"));\r\nvar PlayerData = /** @class */ (function () {\r\n    function PlayerData(x, y, deviceId) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.transactionType = TransactionType.PlayerData;\r\n        this.playerState = PlayerState.idle;\r\n        this.characterAppearanceType = CharacterAppearanceType.wichtel1;\r\n        this.isAngryDad = undefined;\r\n        this.id = 0;\r\n        this.id = deviceId;\r\n    }\r\n    return PlayerData;\r\n}());\r\nexports.PlayerData = PlayerData;\r\nvar TransactionType;\r\n(function (TransactionType) {\r\n    TransactionType[TransactionType[\"ServerData\"] = 0] = \"ServerData\";\r\n    TransactionType[TransactionType[\"PlayerData\"] = 1] = \"PlayerData\";\r\n    TransactionType[TransactionType[\"ControllerData\"] = 2] = \"ControllerData\";\r\n    TransactionType[TransactionType[\"ObjectData\"] = 3] = \"ObjectData\";\r\n})(TransactionType = exports.TransactionType || (exports.TransactionType = {}));\r\nvar ServerState;\r\n(function (ServerState) {\r\n    ServerState[ServerState[\"initial\"] = 0] = \"initial\";\r\n    ServerState[ServerState[\"lobby\"] = 1] = \"lobby\";\r\n    ServerState[ServerState[\"characterSelection\"] = 2] = \"characterSelection\";\r\n    ServerState[ServerState[\"running\"] = 3] = \"running\";\r\n    ServerState[ServerState[\"final\"] = 4] = \"final\";\r\n})(ServerState = exports.ServerState || (exports.ServerState = {}));\r\nvar ControllerData = /** @class */ (function () {\r\n    function ControllerData(x, y) {\r\n        if (x === void 0) { x = 0; }\r\n        if (y === void 0) { y = 0; }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.transactionType = TransactionType.ControllerData;\r\n        this.id = 0;\r\n    }\r\n    return ControllerData;\r\n}());\r\nexports.ControllerData = ControllerData;\r\nvar ServerData = /** @class */ (function () {\r\n    function ServerData(timerValueInSeconds, serverState) {\r\n        if (timerValueInSeconds === void 0) { timerValueInSeconds = 30; }\r\n        if (serverState === void 0) { serverState = ServerState.initial; }\r\n        this.timerValueInSeconds = timerValueInSeconds;\r\n        this.serverState = serverState;\r\n    }\r\n    return ServerData;\r\n}());\r\nexports.ServerData = ServerData;\r\nvar PlayerState;\r\n(function (PlayerState) {\r\n    PlayerState[PlayerState[\"idle\"] = 0] = \"idle\";\r\n    PlayerState[PlayerState[\"dead\"] = 1] = \"dead\";\r\n    PlayerState[PlayerState[\"running\"] = 2] = \"running\";\r\n    PlayerState[PlayerState[\"interacting\"] = 3] = \"interacting\";\r\n})(PlayerState = exports.PlayerState || (exports.PlayerState = {}));\r\nvar CharacterAppearanceType;\r\n(function (CharacterAppearanceType) {\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel1\"] = 0] = \"wichtel1\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel2\"] = 1] = \"wichtel2\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel3\"] = 2] = \"wichtel3\";\r\n    CharacterAppearanceType[CharacterAppearanceType[\"wichtel4\"] = 3] = \"wichtel4\";\r\n})(CharacterAppearanceType = exports.CharacterAppearanceType || (exports.CharacterAppearanceType = {}));\r\nvar ObjectData = /** @class */ (function () {\r\n    function ObjectData(x, y, id) {\r\n        if (x === void 0) { x = 0; }\r\n        if (y === void 0) { y = 0; }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.id = id;\r\n    }\r\n    return ObjectData;\r\n}());\r\nexports.ObjectData = ObjectData;\r\n\r\n\r\n\r\n},{\"./client\":1,\"./server\":3}],3:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"./index\");\r\nvar Server = /** @class */ (function () {\r\n    function Server() {\r\n        var _this = this;\r\n        this.airConsole = new AirConsole();\r\n        this.serverData = new index_1.ServerData();\r\n        this.playerData = [];\r\n        this.objectData = [];\r\n        this.updateServerState = function () { return function (cb) {\r\n            cb(_this.serverData.serverState);\r\n        }; };\r\n        this.updateControllerData = function (controllerData) { return function (cb) {\r\n            cb(controllerData);\r\n        }; };\r\n        this.subscribeToAirConsole();\r\n    }\r\n    Server.prototype.createAndUpdatePlayer = function (data) {\r\n        var playerFound = this.playerData.find(function (pD) { return pD.id === data.id; });\r\n        if (!playerFound) {\r\n            playerFound = new index_1.PlayerData(0, 0, data.id);\r\n            this.playerData.push(playerFound);\r\n            this.startAfterFirstPlayerJoined();\r\n        }\r\n        this.updatePlayer(data);\r\n    };\r\n    Server.prototype.startAfterFirstPlayerJoined = function () {\r\n        var _this = this;\r\n        if (this.playerData.length == 1) {\r\n            this.serverData.serverState = index_1.ServerState.lobby;\r\n            this.updateServerState();\r\n            this.serverStateUpdate(30, index_1.ServerState.characterSelection, function () {\r\n                _this.serverStateUpdate(15, index_1.ServerState.running, function () {\r\n                    _this.serverStateUpdate(300, index_1.ServerState.final, function () { });\r\n                });\r\n            });\r\n        }\r\n    };\r\n    Server.prototype.serverStateUpdate = function (timerValueInSeconds, serverState, cb) {\r\n        var _this = this;\r\n        var timer = this.setAndStartTimer(timerValueInSeconds);\r\n        setTimeout(function () {\r\n            _this.serverData.serverState = serverState;\r\n            _this.updateServerState();\r\n            cb();\r\n            clearInterval(timer);\r\n        }, timerValueInSeconds);\r\n    };\r\n    Server.prototype.setAndStartTimer = function (timerValueInSeconds) {\r\n        var _this = this;\r\n        this.serverData.timerValueInSeconds = timerValueInSeconds;\r\n        return setInterval(function () {\r\n            if (_this.serverData.timerValueInSeconds)\r\n                _this.serverData.timerValueInSeconds--;\r\n            _this.sendServerData();\r\n        }, 1000);\r\n    };\r\n    Server.prototype.updatePlayer = function (updateData) {\r\n        var player = this.playerData.filter(function (pD) { return pD.id === updateData.id; })[0];\r\n        player = player;\r\n        this.sendPlayerData();\r\n    };\r\n    Server.prototype.sendAllClients = function (data) {\r\n        this.airConsole.broadcast(data);\r\n    };\r\n    Server.prototype.onMessage = function () {\r\n        var _this = this;\r\n        this.airConsole.onMessage = function (from, data) {\r\n            switch (data.transactionType) {\r\n                case index_1.TransactionType.PlayerData:\r\n                    _this.createAndUpdatePlayer(data);\r\n                    break;\r\n                case index_1.TransactionType.ControllerData:\r\n                    _this.updateControllerData(data);\r\n                    //JS after change   this.updatePlayer()\r\n                    break;\r\n                default:\r\n                    console.error(\"not implemented\", data);\r\n                    break;\r\n            }\r\n            _this.sendPlayerData();\r\n        };\r\n    };\r\n    Server.prototype.subscribeToAirConsole = function () {\r\n        var _this = this;\r\n        this.airConsole.onConnect = function (id) {\r\n            _this.createAndUpdatePlayer({ id: id });\r\n            _this.sendObjectData();\r\n            _this.sendServerData();\r\n        };\r\n    };\r\n    Server.prototype.sendPlayerData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.PlayerData,\r\n            playerData: this.playerData\r\n        });\r\n    };\r\n    Server.prototype.sendObjectData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.ObjectData,\r\n            objectData: this.objectData\r\n        });\r\n    };\r\n    Server.prototype.sendServerData = function () {\r\n        this.sendAllClients({\r\n            transactionType: index_1.TransactionType.ServerData,\r\n            serverData: this.serverData\r\n        });\r\n    };\r\n    return Server;\r\n}());\r\nexports.Server = Server;\r\n\r\n\r\n\r\n},{\"./index\":2}],4:[function(require,module,exports){\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar index_1 = require(\"../common/index\");\r\nvar Views;\r\n(function (Views) {\r\n    Views[Views[\"splashscreen\"] = 0] = \"splashscreen\";\r\n    Views[Views[\"characterselection\"] = 1] = \"characterselection\";\r\n    Views[Views[\"playscreen\"] = 2] = \"playscreen\";\r\n    Views[Views[\"endscreen\"] = 3] = \"endscreen\";\r\n})(Views || (Views = {}));\r\nvar Controller = /** @class */ (function () {\r\n    function Controller(client) {\r\n        var _this = this;\r\n        this.client = client;\r\n        this.startPos = undefined;\r\n        document.addEventListener('DOMContentLoaded', function () {\r\n            _this.virtualController();\r\n            _this.client.onUpdateServerData(_this.updateView.bind(_this));\r\n        });\r\n    }\r\n    Controller.prototype.showView = function (view) {\r\n        document.querySelectorAll(Views[view])[0].classList.add('visible');\r\n    };\r\n    Controller.prototype.hideView = function (view) {\r\n        document.querySelectorAll(Views[view])[0].classList.remove('visible');\r\n    };\r\n    Controller.prototype.updateView = function (serverData) {\r\n        switch (serverData.serverState) {\r\n            case index_1.ServerState.lobby:\r\n                this.showView(Views.splashscreen);\r\n                break;\r\n            case index_1.ServerState.characterSelection:\r\n                this.showView(Views.characterselection);\r\n                break;\r\n            case index_1.ServerState.running:\r\n                this.showView(Views.playscreen);\r\n                break;\r\n            case index_1.ServerState.final:\r\n                this.showView(Views.endscreen);\r\n                break;\r\n            default:\r\n                console.error('not implemented', serverData);\r\n        }\r\n    };\r\n    Controller.prototype.virtualController = function () {\r\n        var _this = this;\r\n        document.querySelectorAll('controller')[0].addEventListener('touchstart', function (ev) {\r\n            console.log('touchstart');\r\n            _this.startPos = [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];\r\n        });\r\n        document.querySelectorAll('controller')[0].addEventListener('touchmove', function (ev) {\r\n            if (_this.startPos !== undefined) {\r\n                _this.client.sendControllerData(new index_1.ControllerData(ev.targetTouches[0].clientX - _this.startPos[0], ev.targetTouches[0].clientY - _this.startPos[1]));\r\n            }\r\n        });\r\n        document.querySelectorAll('controller')[0].addEventListener('touchend', function (ev) {\r\n            _this.startPos = undefined;\r\n        });\r\n    };\r\n    Controller.prototype.splashscreen = function () {\r\n        var _this = this;\r\n        document.querySelectorAll('splashscreen > button').forEach(function (btn) {\r\n            var character = document.querySelectorAll('splashscreen > character')[0];\r\n            var isPlayerAngryDad = _this.client.toggleAngryDad();\r\n            if (isPlayerAngryDad) {\r\n                character.innerHTML = 'You would like to be angry dad!';\r\n            }\r\n            else {\r\n                character.innerHTML = 'You would like to be a wichtel!';\r\n            }\r\n        });\r\n        var timeUntilStartInterval = setInterval(function () {\r\n            var timeUntilStart = _this.client.getTime();\r\n            document.querySelectorAll('splashscreen > time')[0].innerHTML = timeUntilStart.toString();\r\n            if (timeUntilStart === 0) {\r\n                clearInterval(timeUntilStartInterval);\r\n            }\r\n        }, 1000);\r\n    };\r\n    return Controller;\r\n}());\r\nvar client = new index_1.Client();\r\nnew Controller(client);\r\n\r\n\r\n\r\n},{\"../common/index\":2}]},{},[4]);\r\n\r\n//# sourceMappingURL=index.js.map\r\n"]}